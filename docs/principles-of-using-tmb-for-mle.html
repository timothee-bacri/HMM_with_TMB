<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 2 Principles of using TMB for MLE | A gentle tutorial of accelerated parameter and confidence interval estimation for Hidden Markov Models using Template Model Builder</title>
  <meta name="description" content="This accompanies the article published at [GITHUB LINK]." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content=" 2 Principles of using TMB for MLE | A gentle tutorial of accelerated parameter and confidence interval estimation for Hidden Markov Models using Template Model Builder" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/timothee-bacri/HMM_with_TMB" />
  
  <meta property="og:description" content="This accompanies the article published at [GITHUB LINK]." />
  <meta name="github-repo" content="timothee-bacri/HMM_with_TMB" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 2 Principles of using TMB for MLE | A gentle tutorial of accelerated parameter and confidence interval estimation for Hidden Markov Models using Template Model Builder" />
  
  <meta name="twitter:description" content="This accompanies the article published at [GITHUB LINK]." />
  

<meta name="author" content="Timothée Bacri timothee.bacri@uib.no" />
<meta name="author" content="Jan Bulla jan.bulla@uib.no" />
<meta name="author" content="Geir Berentsen geir.berentsen@nhh.no" />
<meta name="author" content="Sondre Hølleland sondre.hoelleland@hi.no" />


<meta name="date" content="2022-02-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="parameter-estimation-techniques-for-hmms.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="width.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A gentle tutorial of accelerated<br>parameter and confidence interval<br>estimation for Hidden Markov Models<BR>using Template Model Builder</a></li>
<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="principles-of-using-tmb-for-mle.html"><a href="principles-of-using-tmb-for-mle.html"><i class="fa fa-check"></i><b>2</b> Principles of using <code>TMB</code> for MLE</a>
<ul>
<li class="chapter" data-level="2.1" data-path="principles-of-using-tmb-for-mle.html"><a href="principles-of-using-tmb-for-mle.html#setup"><i class="fa fa-check"></i><b>2.1</b> Setup</a></li>
<li class="chapter" data-level="2.2" data-path="principles-of-using-tmb-for-mle.html"><a href="principles-of-using-tmb-for-mle.html#linear-regression-example"><i class="fa fa-check"></i><b>2.2</b> Linear regression example</a></li>
<li class="chapter" data-level="2.3" data-path="principles-of-using-tmb-for-mle.html"><a href="principles-of-using-tmb-for-mle.html#extending-the-c-nll"><i class="fa fa-check"></i><b>2.3</b> Extending the <code>C++</code> nll</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html"><i class="fa fa-check"></i><b>3</b> Parameter estimation techniques<br>for HMMs</a>
<ul>
<li class="chapter" data-level="3.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#basic-notation-and-model-setup"><i class="fa fa-check"></i><b>3.1</b> Basic notation and model setup</a></li>
<li class="chapter" data-level="3.2" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#the-likelihood-function-of-an-hmm"><i class="fa fa-check"></i><b>3.2</b> The likelihood function of an HMM</a></li>
<li class="chapter" data-level="3.3" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#forward-backward"><i class="fa fa-check"></i><b>3.3</b> Forward algorithm and<br>backward algorithm</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#setup-1"><i class="fa fa-check"></i><b>3.3.1</b> Setup</a>
<ul>
<li class="chapter" data-level="3.3.1.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#prepare-the-model"><i class="fa fa-check"></i><b>3.3.1.1</b> Prepare the model</a></li>
<li class="chapter" data-level="3.3.1.2" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#define-variables"><i class="fa fa-check"></i><b>3.3.1.2</b> Define variables</a></li>
<li class="chapter" data-level="3.3.1.3" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#emissionoutput-probabilities"><i class="fa fa-check"></i><b>3.3.1.3</b> Emission/output probabilities</a></li>
</ul></li>
<li class="chapter" data-level="3.3.2" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#log-forward"><i class="fa fa-check"></i><b>3.3.2</b> Log-forward probabilities</a></li>
<li class="chapter" data-level="3.3.3" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#log-backward"><i class="fa fa-check"></i><b>3.3.3</b> Log-backward probabilities</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#reparameterization-of-the-likelihood-function"><i class="fa fa-check"></i><b>3.4</b> Reparameterization of the<br>likelihood function</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#utility-functions-in-tmb"><i class="fa fa-check"></i><b>3.4.1</b> Utility functions in <code>TMB</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#utility-functions-in-r"><i class="fa fa-check"></i><b>3.4.2</b> Utility functions in <code>R</code></a>
<ul>
<li class="chapter" data-level="3.4.2.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#label-switching"><i class="fa fa-check"></i><b>3.4.2.1</b> Label switching</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="using-tmb.html"><a href="using-tmb.html"><i class="fa fa-check"></i><b>4</b> Using <code>TMB</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="using-tmb.html"><a href="using-tmb.html#likelihood-function"><i class="fa fa-check"></i><b>4.1</b> Likelihood function</a></li>
<li class="chapter" data-level="4.2" data-path="using-tmb.html"><a href="using-tmb.html#optimization"><i class="fa fa-check"></i><b>4.2</b> Optimization</a></li>
<li class="chapter" data-level="4.3" data-path="using-tmb.html"><a href="using-tmb.html#basic-nested-model-specification"><i class="fa fa-check"></i><b>4.3</b> Basic nested model<br>specification</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="using-tmb.html"><a href="using-tmb.html#principle"><i class="fa fa-check"></i><b>4.3.1</b> Principle</a></li>
<li class="chapter" data-level="4.3.2" data-path="using-tmb.html"><a href="using-tmb.html#limits"><i class="fa fa-check"></i><b>4.3.2</b> Limits</a></li>
<li class="chapter" data-level="4.3.3" data-path="using-tmb.html"><a href="using-tmb.html#param-eq-constraints"><i class="fa fa-check"></i><b>4.3.3</b> Parameter equality<br>constraints</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="using-tmb.html"><a href="using-tmb.html#state-inference"><i class="fa fa-check"></i><b>4.4</b> State inference and forecasting</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="using-tmb.html"><a href="using-tmb.html#local-decoding"><i class="fa fa-check"></i><b>4.4.1</b> Local decoding</a></li>
<li class="chapter" data-level="4.4.2" data-path="using-tmb.html"><a href="using-tmb.html#forecast"><i class="fa fa-check"></i><b>4.4.2</b> Forecast</a></li>
<li class="chapter" data-level="4.4.3" data-path="using-tmb.html"><a href="using-tmb.html#global-decoding"><i class="fa fa-check"></i><b>4.4.3</b> Global decoding</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="using-tmb.html"><a href="using-tmb.html#appendix"><i class="fa fa-check"></i><b>4.5</b> Appendix</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="confidence-intervals.html"><a href="confidence-intervals.html"><i class="fa fa-check"></i><b>5</b> Confidence intervals</a>
<ul>
<li class="chapter" data-level="5.1" data-path="confidence-intervals.html"><a href="confidence-intervals.html#Wald-type"><i class="fa fa-check"></i><b>5.1</b> Wald-type confidence<br>intervals based on the Hessian</a></li>
<li class="chapter" data-level="5.2" data-path="confidence-intervals.html"><a href="confidence-intervals.html#likelihood-profile-based-confidence-intervals"><i class="fa fa-check"></i><b>5.2</b> Likelihood profile based<br>confidence intervals</a></li>
<li class="chapter" data-level="5.3" data-path="confidence-intervals.html"><a href="confidence-intervals.html#bootstrap-based-confidence-intervals"><i class="fa fa-check"></i><b>5.3</b> Bootstrap-based<br>confidence intervals</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="confidence-intervals.html"><a href="confidence-intervals.html#generating-data"><i class="fa fa-check"></i><b>5.3.1</b> Generating data</a></li>
<li class="chapter" data-level="5.3.2" data-path="confidence-intervals.html"><a href="confidence-intervals.html#bootstrap"><i class="fa fa-check"></i><b>5.3.2</b> Bootstrap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="application-to-different-data-sets.html"><a href="application-to-different-data-sets.html"><i class="fa fa-check"></i><b>6</b> Application to different data sets</a>
<ul>
<li class="chapter" data-level="6.1" data-path="application-to-different-data-sets.html"><a href="application-to-different-data-sets.html#tyt-data"><i class="fa fa-check"></i><b>6.1</b> TYT data</a></li>
<li class="chapter" data-level="6.2" data-path="application-to-different-data-sets.html"><a href="application-to-different-data-sets.html#lamb-data"><i class="fa fa-check"></i><b>6.2</b> Lamb data</a></li>
<li class="chapter" data-level="6.3" data-path="application-to-different-data-sets.html"><a href="application-to-different-data-sets.html#simulated-data"><i class="fa fa-check"></i><b>6.3</b> Simulated data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html"><i class="fa fa-check"></i><b>7</b> Gaussian HMM</a>
<ul>
<li class="chapter" data-level="7.1" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html#dataset"><i class="fa fa-check"></i><b>7.1</b> Dataset</a></li>
<li class="chapter" data-level="7.2" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html#likelihood-function-1"><i class="fa fa-check"></i><b>7.2</b> Likelihood function</a></li>
<li class="chapter" data-level="7.3" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html#estimation"><i class="fa fa-check"></i><b>7.3</b> Estimation</a></li>
<li class="chapter" data-level="7.4" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html#results"><i class="fa fa-check"></i><b>7.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html"><i class="fa fa-check"></i><b>8</b> Multivariate Gaussian HMM</a>
<ul>
<li class="chapter" data-level="8.1" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#dataset-parameters"><i class="fa fa-check"></i><b>8.1</b> Dataset &amp; Parameters</a></li>
<li class="chapter" data-level="8.2" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#likelihood-function-2"><i class="fa fa-check"></i><b>8.2</b> Likelihood function</a></li>
<li class="chapter" data-level="8.3" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#estimation-1"><i class="fa fa-check"></i><b>8.3</b> Estimation</a></li>
<li class="chapter" data-level="8.4" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#results-1"><i class="fa fa-check"></i><b>8.4</b> Results</a></li>
<li class="chapter" data-level="8.5" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#bias"><i class="fa fa-check"></i><b>8.5</b> Bias</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>9</b> GitHub</a>
<ul>
<li class="chapter" data-level="9.1" data-path="github.html"><a href="github.html#directory-structure"><i class="fa fa-check"></i><b>9.1</b> Directory structure</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="github.html"><a href="github.html#code"><i class="fa fa-check"></i><b>9.1.1</b> code/</a></li>
<li class="chapter" data-level="9.1.2" data-path="github.html"><a href="github.html#linreg.cpp"><i class="fa fa-check"></i><b>9.1.2</b> code/linreg.cpp</a></li>
<li class="chapter" data-level="9.1.3" data-path="github.html"><a href="github.html#linreg_extended.cpp"><i class="fa fa-check"></i><b>9.1.3</b> code/linreg_extended.cpp</a></li>
<li class="chapter" data-level="9.1.4" data-path="github.html"><a href="github.html#main.R"><i class="fa fa-check"></i><b>9.1.4</b> code/main.R</a></li>
<li class="chapter" data-level="9.1.5" data-path="github.html"><a href="github.html#mvnorm_hmm.cpp"><i class="fa fa-check"></i><b>9.1.5</b> code/mvnorm_hmm.cpp</a></li>
<li class="chapter" data-level="9.1.6" data-path="github.html"><a href="github.html#norm_hmm.cpp"><i class="fa fa-check"></i><b>9.1.6</b> code/norm_hmm.cpp</a></li>
<li class="chapter" data-level="9.1.7" data-path="github.html"><a href="github.html#codepackages.r"><i class="fa fa-check"></i><b>9.1.7</b> code/packages.R</a></li>
<li class="chapter" data-level="9.1.8" data-path="github.html"><a href="github.html#poi_hmm.cpp"><i class="fa fa-check"></i><b>9.1.8</b> code/poi_hmm.cpp</a></li>
<li class="chapter" data-level="9.1.9" data-path="github.html"><a href="github.html#poi_hmm_lamb.R"><i class="fa fa-check"></i><b>9.1.9</b> code/poi_hmm_lamb.R</a></li>
<li class="chapter" data-level="9.1.10" data-path="github.html"><a href="github.html#poi_hmm_simu1.R"><i class="fa fa-check"></i><b>9.1.10</b> code/poi_hmm_simu1.R</a></li>
<li class="chapter" data-level="9.1.11" data-path="github.html"><a href="github.html#poi_hmm_simu2.R"><i class="fa fa-check"></i><b>9.1.11</b> code/poi_hmm_simu2.R</a></li>
<li class="chapter" data-level="9.1.12" data-path="github.html"><a href="github.html#poi_hmm_simu3.R"><i class="fa fa-check"></i><b>9.1.12</b> code/poi_hmm_simu3.R</a></li>
<li class="chapter" data-level="9.1.13" data-path="github.html"><a href="github.html#poi_hmm_simu4.R"><i class="fa fa-check"></i><b>9.1.13</b> code/poi_hmm_simu4.R</a></li>
<li class="chapter" data-level="9.1.14" data-path="github.html"><a href="github.html#poi_hmm_tinn.R"><i class="fa fa-check"></i><b>9.1.14</b> code/poi_hmm_tinn.R</a></li>
<li class="chapter" data-level="9.1.15" data-path="github.html"><a href="github.html#setup_parameters.R"><i class="fa fa-check"></i><b>9.1.15</b> code/setup_parameters.R</a></li>
<li class="chapter" data-level="9.1.16" data-path="github.html"><a href="github.html#data"><i class="fa fa-check"></i><b>9.1.16</b> data/</a></li>
<li class="chapter" data-level="9.1.17" data-path="github.html"><a href="github.html#fetal-lamb.RData"><i class="fa fa-check"></i><b>9.1.17</b> data/fetal-lamb.RData</a></li>
<li class="chapter" data-level="9.1.18" data-path="github.html"><a href="github.html#dataresults_lamb.rdata"><i class="fa fa-check"></i><b>9.1.18</b> data/results_lamb.RData</a></li>
<li class="chapter" data-level="9.1.19" data-path="github.html"><a href="github.html#dataresults_simu1.rdata"><i class="fa fa-check"></i><b>9.1.19</b> data/results_simu1.RData</a></li>
<li class="chapter" data-level="9.1.20" data-path="github.html"><a href="github.html#dataresults_simu2.rdata"><i class="fa fa-check"></i><b>9.1.20</b> data/results_simu2.RData</a></li>
<li class="chapter" data-level="9.1.21" data-path="github.html"><a href="github.html#dataresults_simu3.rdata"><i class="fa fa-check"></i><b>9.1.21</b> data/results_simu3.RData</a></li>
<li class="chapter" data-level="9.1.22" data-path="github.html"><a href="github.html#dataresults_simu4.rdata"><i class="fa fa-check"></i><b>9.1.22</b> data/results_simu4.RData</a></li>
<li class="chapter" data-level="9.1.23" data-path="github.html"><a href="github.html#dataresults_tinn.rdata"><i class="fa fa-check"></i><b>9.1.23</b> data/results_tinn.RData</a></li>
<li class="chapter" data-level="9.1.24" data-path="github.html"><a href="github.html#tinnitus.RData"><i class="fa fa-check"></i><b>9.1.24</b> data/tinnitus.RData</a></li>
<li class="chapter" data-level="9.1.25" data-path="github.html"><a href="github.html#functions"><i class="fa fa-check"></i><b>9.1.25</b> functions/</a></li>
<li class="chapter" data-level="9.1.26" data-path="github.html"><a href="github.html#mvnorm_utils.cpp"><i class="fa fa-check"></i><b>9.1.26</b> functions/mvnorm_utils.cpp</a></li>
<li class="chapter" data-level="9.1.27" data-path="github.html"><a href="github.html#mvnorm_utils.R"><i class="fa fa-check"></i><b>9.1.27</b> functions/mvnorm_utils.R</a></li>
<li class="chapter" data-level="9.1.28" data-path="github.html"><a href="github.html#norm_utils.cpp"><i class="fa fa-check"></i><b>9.1.28</b> functions/norm_utils.cpp</a></li>
<li class="chapter" data-level="9.1.29" data-path="github.html"><a href="github.html#norm_utils.R"><i class="fa fa-check"></i><b>9.1.29</b> functions/norm_utils.R</a></li>
<li class="chapter" data-level="9.1.30" data-path="github.html"><a href="github.html#utils.cpp"><i class="fa fa-check"></i><b>9.1.30</b> functions/utils.cpp</a></li>
<li class="chapter" data-level="9.1.31" data-path="github.html"><a href="github.html#utils.R"><i class="fa fa-check"></i><b>9.1.31</b> functions/utils.R</a></li>
<li class="chapter" data-level="9.1.32" data-path="github.html"><a href="github.html#utils.R-explanation.R"><i class="fa fa-check"></i><b>9.1.32</b> functions/utils.R-explanation.R</a></li>
<li class="chapter" data-level="9.1.33" data-path="github.html"><a href="github.html#utils_linreg_extended.cpp"><i class="fa fa-check"></i><b>9.1.33</b> functions/utils_linreg_extended.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A gentle tutorial of accelerated parameter and confidence interval estimation for Hidden Markov Models using Template Model Builder</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="principles-of-using-tmb-for-mle" class="section level1" number="2">
<h1><span class="header-section-number"> 2</span> Principles of using <code>TMB</code> for MLE</h1>
<div id="setup" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Setup</h2>
<p>In order to run the scripts and example code, you first need to set up TMB by going through the following steps:</p>
<ul>
<li>Install <a href="https://cran.r-project.org">Rtools</a></li>
<li>Install the R-package <code>TMB</code> <span class="citation">(<a href="references.html#ref-R-TMB" role="doc-biblioref">Kristensen 2021</a>)</span> by executing the following code in R:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="principles-of-using-tmb-for-mle.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;TMB&quot;</span>)</span></code></pre></div>
<ul>
<li>(Optional) Setup error debugging in <code>RStudio</code> by running the command <code>TMB:::setupRstudio()</code></li>
</ul>
<p>Advanced use is detailed in <a href="https://kaskr.github.io/adcomp/_book/Tutorial.html" class="uri">https://kaskr.github.io/adcomp/_book/Tutorial.html</a></p>
</div>
<div id="linear-regression-example" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Linear regression example</h2>
<p>Let <span class="math inline">\({\boldsymbol x}\)</span> and <span class="math inline">\({\boldsymbol y}\)</span> denote the predictor and response vector, respectively, both of length <span class="math inline">\(n\)</span>.
For a simple linear regression model with intercept <span class="math inline">\(a\)</span> and slope <span class="math inline">\(b\)</span>, the negative log-likelihood equals
<span class="math display">\[\begin{equation*}
- \log L(a, b, \sigma^2) = - \sum_{i=1}^n \log(\phi(y_i; a + bx_i, \sigma^2)),
\end{equation*}\]</span>
where <span class="math inline">\(\phi(\cdot; \mu, \sigma^2)\)</span> corresponds to the density function of the univariate normal distribution with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span>.</p>
<p>The use of <code>TMB</code> requires the (negative) log-likelihood function to be coded in C++ under a specific template, which is then loaded into R.
The minimization of this function and other post-processing procedures are all carried out in <code>R</code>.
Therefore, we require two files.<br />
The first file, named <em><a href="github.html#linreg.cpp">code/linreg.cpp</a></em>, is written in C++ and defines the objective function, i.e. the negative log-likelihood (nll) function of the linear model.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="principles-of-using-tmb-for-mle.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;TMB.hpp&gt;</span><span class="pp"> </span><span class="co">//import the TMB template</span></span>
<span id="cb2-2"><a href="principles-of-using-tmb-for-mle.html#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="principles-of-using-tmb-for-mle.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb2-4"><a href="principles-of-using-tmb-for-mle.html#cb2-4" aria-hidden="true" tabindex="-1"></a>Type objective_function<span class="op">&lt;</span>Type<span class="op">&gt;::</span><span class="kw">operator</span><span class="op">()</span> <span class="op">()</span></span>
<span id="cb2-5"><a href="principles-of-using-tmb-for-mle.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-6"><a href="principles-of-using-tmb-for-mle.html#cb2-6" aria-hidden="true" tabindex="-1"></a>  DATA_VECTOR<span class="op">(</span>y<span class="op">);</span> <span class="co">// Data vector y passed from R</span></span>
<span id="cb2-7"><a href="principles-of-using-tmb-for-mle.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  DATA_VECTOR<span class="op">(</span>x<span class="op">);</span> <span class="co">// Data vector x passed from R</span></span>
<span id="cb2-8"><a href="principles-of-using-tmb-for-mle.html#cb2-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-9"><a href="principles-of-using-tmb-for-mle.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  PARAMETER<span class="op">(</span>a<span class="op">);</span>         <span class="co">// Parameter a passed from R </span></span>
<span id="cb2-10"><a href="principles-of-using-tmb-for-mle.html#cb2-10" aria-hidden="true" tabindex="-1"></a>  PARAMETER<span class="op">(</span>b<span class="op">);</span>         <span class="co">// Parameter b passed from R </span></span>
<span id="cb2-11"><a href="principles-of-using-tmb-for-mle.html#cb2-11" aria-hidden="true" tabindex="-1"></a>  PARAMETER<span class="op">(</span>tsigma<span class="op">);</span>    <span class="co">// Parameter sigma (transformed, on log-scale)</span></span>
<span id="cb2-12"><a href="principles-of-using-tmb-for-mle.html#cb2-12" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// passed from R</span></span>
<span id="cb2-13"><a href="principles-of-using-tmb-for-mle.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-14"><a href="principles-of-using-tmb-for-mle.html#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Transform tsigma back to natural scale</span></span>
<span id="cb2-15"><a href="principles-of-using-tmb-for-mle.html#cb2-15" aria-hidden="true" tabindex="-1"></a>  Type sigma <span class="op">=</span> exp<span class="op">(</span>tsigma<span class="op">);</span></span>
<span id="cb2-16"><a href="principles-of-using-tmb-for-mle.html#cb2-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-17"><a href="principles-of-using-tmb-for-mle.html#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Declare negative log-likelihood</span></span>
<span id="cb2-18"><a href="principles-of-using-tmb-for-mle.html#cb2-18" aria-hidden="true" tabindex="-1"></a>  Type nll <span class="op">=</span> <span class="op">-</span> sum<span class="op">(</span>dnorm<span class="op">(</span>y<span class="op">,</span></span>
<span id="cb2-19"><a href="principles-of-using-tmb-for-mle.html#cb2-19" aria-hidden="true" tabindex="-1"></a>                         a <span class="op">+</span> b <span class="op">*</span> x<span class="op">,</span></span>
<span id="cb2-20"><a href="principles-of-using-tmb-for-mle.html#cb2-20" aria-hidden="true" tabindex="-1"></a>                         sigma<span class="op">,</span></span>
<span id="cb2-21"><a href="principles-of-using-tmb-for-mle.html#cb2-21" aria-hidden="true" tabindex="-1"></a>                         <span class="kw">true</span><span class="op">));</span></span>
<span id="cb2-22"><a href="principles-of-using-tmb-for-mle.html#cb2-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-23"><a href="principles-of-using-tmb-for-mle.html#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Necessary for inference on sigma, not only tsigma</span></span>
<span id="cb2-24"><a href="principles-of-using-tmb-for-mle.html#cb2-24" aria-hidden="true" tabindex="-1"></a>  ADREPORT<span class="op">(</span>sigma<span class="op">);</span></span>
<span id="cb2-25"><a href="principles-of-using-tmb-for-mle.html#cb2-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-26"><a href="principles-of-using-tmb-for-mle.html#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> nll<span class="op">;</span></span>
<span id="cb2-27"><a href="principles-of-using-tmb-for-mle.html#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The second file needed is written in <code>R</code> and serves for compiling the nll function defined above and carrying out the estimation procedure by numerical optimization of the nll function.
The .R file (shown below) carries out the compilation of the C++ file and minimization of the nll function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="principles-of-using-tmb-for-mle.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading TMB package</span></span>
<span id="cb3-2"><a href="principles-of-using-tmb-for-mle.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TMB)</span>
<span id="cb3-3"><a href="principles-of-using-tmb-for-mle.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compilation. The compiler returns 0 if the compilation of</span></span>
<span id="cb3-4"><a href="principles-of-using-tmb-for-mle.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the cpp file was successful</span></span>
<span id="cb3-5"><a href="principles-of-using-tmb-for-mle.html#cb3-5" aria-hidden="true" tabindex="-1"></a>TMB<span class="sc">::</span><span class="fu">compile</span>(<span class="st">&quot;code/linreg.cpp&quot;</span>)</span>
<span id="cb3-6"><a href="principles-of-using-tmb-for-mle.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span>
<span id="cb3-7"><a href="principles-of-using-tmb-for-mle.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Dynamic loading of the compiled cpp file</span></span>
<span id="cb3-8"><a href="principles-of-using-tmb-for-mle.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dyn.load</span>(<span class="fu">dynlib</span>(<span class="st">&quot;code/linreg&quot;</span>))</span>
<span id="cb3-9"><a href="principles-of-using-tmb-for-mle.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the data for our test sample</span></span>
<span id="cb3-10"><a href="principles-of-using-tmb-for-mle.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-11"><a href="principles-of-using-tmb-for-mle.html#cb3-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>) <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb3-12"><a href="principles-of-using-tmb-for-mle.html#cb3-12" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">tsigma =</span> <span class="dv">0</span>)</span>
<span id="cb3-13"><a href="principles-of-using-tmb-for-mle.html#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Instruct TMB to create the likelihood function</span></span>
<span id="cb3-14"><a href="principles-of-using-tmb-for-mle.html#cb3-14" aria-hidden="true" tabindex="-1"></a>obj_linreg <span class="ot">&lt;-</span> <span class="fu">MakeADFun</span>(data, parameters, <span class="at">DLL =</span> <span class="st">&quot;linreg&quot;</span>,</span>
<span id="cb3-15"><a href="principles-of-using-tmb-for-mle.html#cb3-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-16"><a href="principles-of-using-tmb-for-mle.html#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimization of the objective function with nlminb</span></span>
<span id="cb3-17"><a href="principles-of-using-tmb-for-mle.html#cb3-17" aria-hidden="true" tabindex="-1"></a>mod_linreg <span class="ot">&lt;-</span> <span class="fu">nlminb</span>(obj_linreg<span class="sc">$</span>par, obj_linreg<span class="sc">$</span>fn,</span>
<span id="cb3-18"><a href="principles-of-using-tmb-for-mle.html#cb3-18" aria-hidden="true" tabindex="-1"></a>                     obj_linreg<span class="sc">$</span>gr,</span>
<span id="cb3-19"><a href="principles-of-using-tmb-for-mle.html#cb3-19" aria-hidden="true" tabindex="-1"></a>                     obj_linreg<span class="sc">$</span>he)</span>
<span id="cb3-20"><a href="principles-of-using-tmb-for-mle.html#cb3-20" aria-hidden="true" tabindex="-1"></a>mod_linreg<span class="sc">$</span>par</span>
<span id="cb3-21"><a href="principles-of-using-tmb-for-mle.html#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="do">##           a           b      tsigma </span></span>
<span id="cb3-22"><a href="principles-of-using-tmb-for-mle.html#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.31009251  0.98395536 -0.05814649</span></span></code></pre></div>
<p>It is noteworthy that if one estimates multiple models (for example on the same data with different initial values of parameters), then <code>mod_linreg$par</code> will output the latest optimized parameters.
If one wishes to access the best set of optimized parameters (in terms of likelihood) among the ones that were estimated, then <code>obj_tmb$env$last.par.best</code> will output these.</p>
<p>Now that the optimization is taken care of, we can display the estimates with standard errors using the <code>sdreport</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="principles-of-using-tmb-for-mle.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sdreport</span>(obj_linreg)</span>
<span id="cb4-2"><a href="principles-of-using-tmb-for-mle.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## sdreport(.) result</span></span>
<span id="cb4-3"><a href="principles-of-using-tmb-for-mle.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">##           Estimate Std. Error</span></span>
<span id="cb4-4"><a href="principles-of-using-tmb-for-mle.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">## a       0.31009251 0.43829087</span></span>
<span id="cb4-5"><a href="principles-of-using-tmb-for-mle.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## b       0.98395536 0.03658782</span></span>
<span id="cb4-6"><a href="principles-of-using-tmb-for-mle.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## tsigma -0.05814649 0.15811383</span></span>
<span id="cb4-7"><a href="principles-of-using-tmb-for-mle.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Maximum gradient component: 1.300261e-10</span></span></code></pre></div>
<p>If we use <code>summary</code> on this object, we also get the variables we have passed to <code>ADREPORT</code> in the <em><a href="github.html#linreg.cpp">code/linreg.cpp</a></em> file.
In this example, this is only the residual standard deviation; <code>sigma</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="principles-of-using-tmb-for-mle.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">sdreport</span>(obj_linreg))</span>
<span id="cb5-2"><a href="principles-of-using-tmb-for-mle.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">##           Estimate Std. Error</span></span>
<span id="cb5-3"><a href="principles-of-using-tmb-for-mle.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="do">## a       0.31009251 0.43829087</span></span>
<span id="cb5-4"><a href="principles-of-using-tmb-for-mle.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="do">## b       0.98395536 0.03658782</span></span>
<span id="cb5-5"><a href="principles-of-using-tmb-for-mle.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="do">## tsigma -0.05814649 0.15811383</span></span>
<span id="cb5-6"><a href="principles-of-using-tmb-for-mle.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma   0.94351172 0.14918225</span></span></code></pre></div>
<p>The <code>select</code> argument restricts the output to variables passed
by <code>ADREPORT(variable_name);</code> in the cpp file.
As we will see in the Section <a href="confidence-intervals.html#Wald-type">Wald-type confidence intervals based on the Hessian</a>, this lets us derive confidence intervals for these natural parameters easily.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="principles-of-using-tmb-for-mle.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">sdreport</span>(obj_linreg), <span class="at">select =</span> <span class="st">&quot;report&quot;</span>)</span>
<span id="cb6-2"><a href="principles-of-using-tmb-for-mle.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">##        Estimate Std. Error</span></span>
<span id="cb6-3"><a href="principles-of-using-tmb-for-mle.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.9435117  0.1491823</span></span></code></pre></div>
<p>Certainly, you would not build a TMB model to fit a linear regression. We can use standard R functions for that. Therefore, we use <code>stats::lm</code> on the same data and compare the estimates to those obtained by <code>TMB</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="principles-of-using-tmb-for-mle.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(</span>
<span id="cb7-2"><a href="principles-of-using-tmb-for-mle.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;lm&quot;</span>  <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)<span class="sc">$</span>coef, <span class="co"># linear regression using R</span></span>
<span id="cb7-3"><a href="principles-of-using-tmb-for-mle.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;TMB&quot;</span> <span class="ot">=</span> mod_linreg<span class="sc">$</span>par[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># intercept and slope from TMB fit</span></span>
<span id="cb7-4"><a href="principles-of-using-tmb-for-mle.html#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-5"><a href="principles-of-using-tmb-for-mle.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     (Intercept)         x</span></span>
<span id="cb7-6"><a href="principles-of-using-tmb-for-mle.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">## lm    0.3100925 0.9839554</span></span>
<span id="cb7-7"><a href="principles-of-using-tmb-for-mle.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## TMB   0.3100925 0.9839554</span></span></code></pre></div>
<p>As we can see, the parameter estimates are exactly the same.</p>
</div>
<div id="extending-the-c-nll" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Extending the <code>C++</code> nll</h2>
<p>Sometimes it is useful to write subroutines as a separate function that can be used within your TMB likelihood function.
This can increase readability of your code and reduce the number of lines of code in your main cpp file.
Writing extra files to define functions compatible with <code>TMB</code> requires some care, as these must follow <code>TMB</code>’s template.
<!-- It is noteworthy that `linreg.cpp` doesn't have to contain many lines of code, as they can be distributed in other files and loaded. --></p>
<p>To illustrate how this works, we add a separate function to the <em><a href="github.html#linreg.cpp">code/linreg.cpp</a></em> example.
The following function does not do anything meaningful, but is just meant to show you how you can add write an additional function and load it into your C++.
We start by writing the subroutine function as a separate file called <em><a href="github.html#utils_linreg_extended.cpp">functions/utils_linreg_extended.cpp</a></em>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="principles-of-using-tmb-for-mle.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb8-2"><a href="principles-of-using-tmb-for-mle.html#cb8-2" aria-hidden="true" tabindex="-1"></a>matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> function_example<span class="op">(</span>matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> mat_example<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-3"><a href="principles-of-using-tmb-for-mle.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-4"><a href="principles-of-using-tmb-for-mle.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This function doesn&#39;t do anything meaningful</span></span>
<span id="cb8-5"><a href="principles-of-using-tmb-for-mle.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> mat<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb8-6"><a href="principles-of-using-tmb-for-mle.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  mat<span class="op">.</span>setOnes<span class="op">();</span></span>
<span id="cb8-7"><a href="principles-of-using-tmb-for-mle.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  mat<span class="op">.</span>row<span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb8-8"><a href="principles-of-using-tmb-for-mle.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  mat<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span> <span class="op">=</span> mat<span class="op">.</span>row<span class="op">(</span><span class="dv">1</span><span class="op">).</span>sum<span class="op">();</span></span>
<span id="cb8-9"><a href="principles-of-using-tmb-for-mle.html#cb8-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-10"><a href="principles-of-using-tmb-for-mle.html#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> mat<span class="op">;</span></span>
<span id="cb8-11"><a href="principles-of-using-tmb-for-mle.html#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-12"><a href="principles-of-using-tmb-for-mle.html#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="principles-of-using-tmb-for-mle.html#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb8-14"><a href="principles-of-using-tmb-for-mle.html#cb8-14" aria-hidden="true" tabindex="-1"></a>Type logistic<span class="op">(</span>Type tsigma<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-15"><a href="principles-of-using-tmb-for-mle.html#cb8-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-16"><a href="principles-of-using-tmb-for-mle.html#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">1</span> <span class="op">/</span> <span class="op">(</span><span class="dv">1</span> <span class="op">+</span> exp <span class="op">(-</span>tsigma<span class="op">));</span></span>
<span id="cb8-17"><a href="principles-of-using-tmb-for-mle.html#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>We then import it into <em><a href="github.html#linreg_extended.cpp">code/linreg_extended.cpp</a></em>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="principles-of-using-tmb-for-mle.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;TMB.hpp&gt;</span><span class="pp"> </span><span class="co">//import the TMB template</span></span>
<span id="cb9-2"><a href="principles-of-using-tmb-for-mle.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;../functions/utils_linreg_extended.cpp&quot;</span></span>
<span id="cb9-3"><a href="principles-of-using-tmb-for-mle.html#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="principles-of-using-tmb-for-mle.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb9-5"><a href="principles-of-using-tmb-for-mle.html#cb9-5" aria-hidden="true" tabindex="-1"></a>Type objective_function<span class="op">&lt;</span>Type<span class="op">&gt;::</span><span class="kw">operator</span><span class="op">()</span> <span class="op">()</span></span>
<span id="cb9-6"><a href="principles-of-using-tmb-for-mle.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-7"><a href="principles-of-using-tmb-for-mle.html#cb9-7" aria-hidden="true" tabindex="-1"></a>  DATA_VECTOR<span class="op">(</span>y<span class="op">);</span> <span class="co">// Data vector y passed from R</span></span>
<span id="cb9-8"><a href="principles-of-using-tmb-for-mle.html#cb9-8" aria-hidden="true" tabindex="-1"></a>  DATA_VECTOR<span class="op">(</span>x<span class="op">);</span> <span class="co">// Data vector x passed from R</span></span>
<span id="cb9-9"><a href="principles-of-using-tmb-for-mle.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-10"><a href="principles-of-using-tmb-for-mle.html#cb9-10" aria-hidden="true" tabindex="-1"></a>  PARAMETER<span class="op">(</span>a<span class="op">);</span>         <span class="co">// Parameter a passed from R </span></span>
<span id="cb9-11"><a href="principles-of-using-tmb-for-mle.html#cb9-11" aria-hidden="true" tabindex="-1"></a>  PARAMETER<span class="op">(</span>b<span class="op">);</span>         <span class="co">// Parameter b passed from R </span></span>
<span id="cb9-12"><a href="principles-of-using-tmb-for-mle.html#cb9-12" aria-hidden="true" tabindex="-1"></a>  PARAMETER<span class="op">(</span>tsigma<span class="op">);</span>    <span class="co">// Parameter sigma (transformed by logistic function)</span></span>
<span id="cb9-13"><a href="principles-of-using-tmb-for-mle.html#cb9-13" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// constrained on [0, 1]</span></span>
<span id="cb9-14"><a href="principles-of-using-tmb-for-mle.html#cb9-14" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// passed from R</span></span>
<span id="cb9-15"><a href="principles-of-using-tmb-for-mle.html#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="principles-of-using-tmb-for-mle.html#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Transform tsigma back to natural scale with our external function</span></span>
<span id="cb9-17"><a href="principles-of-using-tmb-for-mle.html#cb9-17" aria-hidden="true" tabindex="-1"></a>  Type sigma <span class="op">=</span> logistic<span class="op">(</span>tsigma<span class="op">);</span></span>
<span id="cb9-18"><a href="principles-of-using-tmb-for-mle.html#cb9-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-19"><a href="principles-of-using-tmb-for-mle.html#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Declare negative log-likelihood</span></span>
<span id="cb9-20"><a href="principles-of-using-tmb-for-mle.html#cb9-20" aria-hidden="true" tabindex="-1"></a>  Type nll <span class="op">=</span> <span class="op">-</span> sum<span class="op">(</span>dnorm<span class="op">(</span>y<span class="op">,</span></span>
<span id="cb9-21"><a href="principles-of-using-tmb-for-mle.html#cb9-21" aria-hidden="true" tabindex="-1"></a>                         a <span class="op">+</span> b <span class="op">*</span> x<span class="op">,</span></span>
<span id="cb9-22"><a href="principles-of-using-tmb-for-mle.html#cb9-22" aria-hidden="true" tabindex="-1"></a>                         sigma<span class="op">,</span></span>
<span id="cb9-23"><a href="principles-of-using-tmb-for-mle.html#cb9-23" aria-hidden="true" tabindex="-1"></a>                         <span class="kw">true</span><span class="op">));</span></span>
<span id="cb9-24"><a href="principles-of-using-tmb-for-mle.html#cb9-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-25"><a href="principles-of-using-tmb-for-mle.html#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Necessary for inference on sigma, not only tsigma</span></span>
<span id="cb9-26"><a href="principles-of-using-tmb-for-mle.html#cb9-26" aria-hidden="true" tabindex="-1"></a>  ADREPORT<span class="op">(</span>sigma<span class="op">);</span></span>
<span id="cb9-27"><a href="principles-of-using-tmb-for-mle.html#cb9-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-28"><a href="principles-of-using-tmb-for-mle.html#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* This is a useless example to show how to manipulate matrices</span></span>
<span id="cb9-29"><a href="principles-of-using-tmb-for-mle.html#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">   * in C++</span></span>
<span id="cb9-30"><a href="principles-of-using-tmb-for-mle.html#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">   * This creates a matrix of 2 rows and 3 columns.</span></span>
<span id="cb9-31"><a href="principles-of-using-tmb-for-mle.html#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">   * The Eigen library is used to manipulate vectors, arrays, matrices...</span></span>
<span id="cb9-32"><a href="principles-of-using-tmb-for-mle.html#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb9-33"><a href="principles-of-using-tmb-for-mle.html#cb9-33" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> mat_example<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb9-34"><a href="principles-of-using-tmb-for-mle.html#cb9-34" aria-hidden="true" tabindex="-1"></a>  mat_example <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb9-35"><a href="principles-of-using-tmb-for-mle.html#cb9-35" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb9-36"><a href="principles-of-using-tmb-for-mle.html#cb9-36" aria-hidden="true" tabindex="-1"></a>  mat_example<span class="op">.</span>setOnes<span class="op">();</span></span>
<span id="cb9-37"><a href="principles-of-using-tmb-for-mle.html#cb9-37" aria-hidden="true" tabindex="-1"></a>  mat_example<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span> <span class="op">=</span> sigma<span class="op">;</span></span>
<span id="cb9-38"><a href="principles-of-using-tmb-for-mle.html#cb9-38" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> mat_example2 <span class="op">=</span> function_example<span class="op">(</span>mat_example<span class="op">);</span></span>
<span id="cb9-39"><a href="principles-of-using-tmb-for-mle.html#cb9-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-40"><a href="principles-of-using-tmb-for-mle.html#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This lets us retrieve any variables in a nice format</span></span>
<span id="cb9-41"><a href="principles-of-using-tmb-for-mle.html#cb9-41" aria-hidden="true" tabindex="-1"></a>  REPORT<span class="op">(</span>mat_example<span class="op">);</span></span>
<span id="cb9-42"><a href="principles-of-using-tmb-for-mle.html#cb9-42" aria-hidden="true" tabindex="-1"></a>  REPORT<span class="op">(</span>mat_example2<span class="op">);</span></span>
<span id="cb9-43"><a href="principles-of-using-tmb-for-mle.html#cb9-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-44"><a href="principles-of-using-tmb-for-mle.html#cb9-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> nll<span class="op">;</span></span>
<span id="cb9-45"><a href="principles-of-using-tmb-for-mle.html#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And eventually we can use it in R, as shown in this minimal example.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="principles-of-using-tmb-for-mle.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading TMB package</span></span>
<span id="cb10-2"><a href="principles-of-using-tmb-for-mle.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TMB)</span>
<span id="cb10-3"><a href="principles-of-using-tmb-for-mle.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compilation. The compiler returns 0 if the compilation of</span></span>
<span id="cb10-4"><a href="principles-of-using-tmb-for-mle.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the cpp file was successful</span></span>
<span id="cb10-5"><a href="principles-of-using-tmb-for-mle.html#cb10-5" aria-hidden="true" tabindex="-1"></a>TMB<span class="sc">::</span><span class="fu">compile</span>(<span class="st">&quot;code/linreg_extended.cpp&quot;</span>)</span>
<span id="cb10-6"><a href="principles-of-using-tmb-for-mle.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span>
<span id="cb10-7"><a href="principles-of-using-tmb-for-mle.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Dynamic loading of the compiled cpp file</span></span>
<span id="cb10-8"><a href="principles-of-using-tmb-for-mle.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dyn.load</span>(<span class="fu">dynlib</span>(<span class="st">&quot;code/linreg_extended&quot;</span>))</span>
<span id="cb10-9"><a href="principles-of-using-tmb-for-mle.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: 2 external pointers will be removed</span></span>
<span id="cb10-10"><a href="principles-of-using-tmb-for-mle.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the data for our test sample</span></span>
<span id="cb10-11"><a href="principles-of-using-tmb-for-mle.html#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb10-12"><a href="principles-of-using-tmb-for-mle.html#cb10-12" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb10-13"><a href="principles-of-using-tmb-for-mle.html#cb10-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">sd =</span> sigma) <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb10-14"><a href="principles-of-using-tmb-for-mle.html#cb10-14" aria-hidden="true" tabindex="-1"></a>tsigma <span class="ot">&lt;-</span> <span class="fu">log</span>(sigma <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> sigma)) <span class="co"># Logit transform</span></span>
<span id="cb10-15"><a href="principles-of-using-tmb-for-mle.html#cb10-15" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">tsigma =</span> <span class="fl">0.1</span>)</span>
<span id="cb10-16"><a href="principles-of-using-tmb-for-mle.html#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Instruct TMB to create the likelihood function</span></span>
<span id="cb10-17"><a href="principles-of-using-tmb-for-mle.html#cb10-17" aria-hidden="true" tabindex="-1"></a>obj_linreg <span class="ot">&lt;-</span> <span class="fu">MakeADFun</span>(data, parameters, <span class="at">DLL =</span> <span class="st">&quot;linreg_extended&quot;</span>,</span>
<span id="cb10-18"><a href="principles-of-using-tmb-for-mle.html#cb10-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-19"><a href="principles-of-using-tmb-for-mle.html#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimization of the objective function with nlminb</span></span>
<span id="cb10-20"><a href="principles-of-using-tmb-for-mle.html#cb10-20" aria-hidden="true" tabindex="-1"></a>mod_linreg <span class="ot">&lt;-</span> <span class="fu">nlminb</span>(obj_linreg<span class="sc">$</span>par, obj_linreg<span class="sc">$</span>fn,</span>
<span id="cb10-21"><a href="principles-of-using-tmb-for-mle.html#cb10-21" aria-hidden="true" tabindex="-1"></a>                     obj_linreg<span class="sc">$</span>gr,</span>
<span id="cb10-22"><a href="principles-of-using-tmb-for-mle.html#cb10-22" aria-hidden="true" tabindex="-1"></a>                     obj_linreg<span class="sc">$</span>he)</span>
<span id="cb10-23"><a href="principles-of-using-tmb-for-mle.html#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Objects returned by ADREPORT() in C++</span></span>
<span id="cb10-24"><a href="principles-of-using-tmb-for-mle.html#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">sdreport</span>(obj_linreg), <span class="at">select =</span> <span class="st">&quot;report&quot;</span>)</span>
<span id="cb10-25"><a href="principles-of-using-tmb-for-mle.html#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="do">##       Estimate Std. Error</span></span>
<span id="cb10-26"><a href="principles-of-using-tmb-for-mle.html#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.566107 0.08950934</span></span>
<span id="cb10-27"><a href="principles-of-using-tmb-for-mle.html#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Object</span></span>
<span id="cb10-28"><a href="principles-of-using-tmb-for-mle.html#cb10-28" aria-hidden="true" tabindex="-1"></a>obj_linreg<span class="sc">$</span><span class="fu">report</span>()</span>
<span id="cb10-29"><a href="principles-of-using-tmb-for-mle.html#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="do">## $mat_example</span></span>
<span id="cb10-30"><a href="principles-of-using-tmb-for-mle.html#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2]      [,3]</span></span>
<span id="cb10-31"><a href="principles-of-using-tmb-for-mle.html#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    1 1.0000000</span></span>
<span id="cb10-32"><a href="principles-of-using-tmb-for-mle.html#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    1    1 0.5658614</span></span>
<span id="cb10-33"><a href="principles-of-using-tmb-for-mle.html#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb10-34"><a href="principles-of-using-tmb-for-mle.html#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="do">## $mat_example2</span></span>
<span id="cb10-35"><a href="principles-of-using-tmb-for-mle.html#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb10-36"><a href="principles-of-using-tmb-for-mle.html#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,]    1    1   15</span></span>
<span id="cb10-37"><a href="principles-of-using-tmb-for-mle.html#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]    5    5    5</span></span></code></pre></div>
<p>Note that when you are writing the <code>C++</code> nll file, compiling the file again may lead to an error.
This is because the dynamic library (the <code>.dll</code> file) is already loaded, and cannot be overwritten.
To prevent this, it is useful either to manually unload the file via the code</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="principles-of-using-tmb-for-mle.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dyn.unload</span>(<span class="fu">dynlib</span>(<span class="st">&quot;code/linreg_extended&quot;</span>))</span></code></pre></div>
<p>or to restart the <code>R</code> session via the menu <code>Session-&gt;Restart R</code> (shortcut <code>Ctrl+Shift+F10</code> on Windows).
Note that restarting the session unloads all packages from the session, and will require you to load the <code>TMB</code> package again.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="parameter-estimation-techniques-for-hmms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
