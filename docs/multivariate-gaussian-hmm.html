<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 8 Multivariate Gaussian HMM | A gentle tutorial of accelerated parameter and confidence interval estimation for Hidden Markov Models using Template Model Builder</title>
  <meta name="description" content="This accompanies the article published at [GITHUB LINK]." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content=" 8 Multivariate Gaussian HMM | A gentle tutorial of accelerated parameter and confidence interval estimation for Hidden Markov Models using Template Model Builder" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/timothee-bacri/HMM_with_TMB" />
  
  <meta property="og:description" content="This accompanies the article published at [GITHUB LINK]." />
  <meta name="github-repo" content="timothee-bacri/HMM_with_TMB" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 8 Multivariate Gaussian HMM | A gentle tutorial of accelerated parameter and confidence interval estimation for Hidden Markov Models using Template Model Builder" />
  
  <meta name="twitter:description" content="This accompanies the article published at [GITHUB LINK]." />
  

<meta name="author" content="Timothée Bacri timothee.bacri@uib.no" />
<meta name="author" content="Jan Bulla jan.bulla@uib.no" />
<meta name="author" content="Geir Berentsen geir.berentsen@nhh.no" />
<meta name="author" content="Sondre Hølleland sondre.hoelleland@hi.no" />


<meta name="date" content="2021-12-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="gaussian-hmm.html"/>
<link rel="next" href="github.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="width.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A gentle tutorial of accelerated<br>parameter and confidence interval<br>estimation for Hidden Markov Models<BR>using Template Model Builder</a></li>
<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="principles-of-using-tmb-for-mle.html"><a href="principles-of-using-tmb-for-mle.html"><i class="fa fa-check"></i><b>2</b> Principles of using <code>TMB</code> for MLE</a>
<ul>
<li class="chapter" data-level="2.1" data-path="principles-of-using-tmb-for-mle.html"><a href="principles-of-using-tmb-for-mle.html#setup"><i class="fa fa-check"></i><b>2.1</b> Setup</a></li>
<li class="chapter" data-level="2.2" data-path="principles-of-using-tmb-for-mle.html"><a href="principles-of-using-tmb-for-mle.html#linear-regression-example"><i class="fa fa-check"></i><b>2.2</b> Linear regression example</a></li>
<li class="chapter" data-level="2.3" data-path="principles-of-using-tmb-for-mle.html"><a href="principles-of-using-tmb-for-mle.html#extending-the-c-nll"><i class="fa fa-check"></i><b>2.3</b> Extending the <code>C++</code> nll</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html"><i class="fa fa-check"></i><b>3</b> Parameter estimation techniques<br>for HMMs</a>
<ul>
<li class="chapter" data-level="3.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#basic-notation-and-model-setup"><i class="fa fa-check"></i><b>3.1</b> Basic notation and model setup</a></li>
<li class="chapter" data-level="3.2" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#the-likelihood-function-of-an-hmm"><i class="fa fa-check"></i><b>3.2</b> The likelihood function of an HMM</a></li>
<li class="chapter" data-level="3.3" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#forward-backward"><i class="fa fa-check"></i><b>3.3</b> Forward algorithm and<br>backward algorithm</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#setup-1"><i class="fa fa-check"></i><b>3.3.1</b> Setup</a>
<ul>
<li class="chapter" data-level="3.3.1.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#prepare-the-model"><i class="fa fa-check"></i><b>3.3.1.1</b> Prepare the model</a></li>
<li class="chapter" data-level="3.3.1.2" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#define-variables"><i class="fa fa-check"></i><b>3.3.1.2</b> Define variables</a></li>
<li class="chapter" data-level="3.3.1.3" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#emissionoutput-probabilities"><i class="fa fa-check"></i><b>3.3.1.3</b> Emission/output probabilities</a></li>
</ul></li>
<li class="chapter" data-level="3.3.2" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#log-forward"><i class="fa fa-check"></i><b>3.3.2</b> Log-forward probabilities</a></li>
<li class="chapter" data-level="3.3.3" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#log-backward"><i class="fa fa-check"></i><b>3.3.3</b> Log-backward probabilities</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#reparameterization-of-the-likelihood-function"><i class="fa fa-check"></i><b>3.4</b> Reparameterization of the<br>likelihood function</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#utility-functions-in-tmb"><i class="fa fa-check"></i><b>3.4.1</b> Utility functions in <code>TMB</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#utility-functions-in-r"><i class="fa fa-check"></i><b>3.4.2</b> Utility functions in <code>R</code></a>
<ul>
<li class="chapter" data-level="3.4.2.1" data-path="parameter-estimation-techniques-for-hmms.html"><a href="parameter-estimation-techniques-for-hmms.html#label-switching"><i class="fa fa-check"></i><b>3.4.2.1</b> Label switching</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="using-tmb.html"><a href="using-tmb.html"><i class="fa fa-check"></i><b>4</b> Using <code>TMB</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="using-tmb.html"><a href="using-tmb.html#likelihood-function"><i class="fa fa-check"></i><b>4.1</b> Likelihood function</a></li>
<li class="chapter" data-level="4.2" data-path="using-tmb.html"><a href="using-tmb.html#optimization"><i class="fa fa-check"></i><b>4.2</b> Optimization</a></li>
<li class="chapter" data-level="4.3" data-path="using-tmb.html"><a href="using-tmb.html#basic-nested-model-specification"><i class="fa fa-check"></i><b>4.3</b> Basic nested model<br>specification</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="using-tmb.html"><a href="using-tmb.html#principle"><i class="fa fa-check"></i><b>4.3.1</b> Principle</a></li>
<li class="chapter" data-level="4.3.2" data-path="using-tmb.html"><a href="using-tmb.html#limits"><i class="fa fa-check"></i><b>4.3.2</b> Limits</a></li>
<li class="chapter" data-level="4.3.3" data-path="using-tmb.html"><a href="using-tmb.html#param-eq-constraints"><i class="fa fa-check"></i><b>4.3.3</b> Parameter equality<br>constraints</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="using-tmb.html"><a href="using-tmb.html#state-inference"><i class="fa fa-check"></i><b>4.4</b> State inference and forecasting</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="using-tmb.html"><a href="using-tmb.html#local-decoding"><i class="fa fa-check"></i><b>4.4.1</b> Local decoding</a></li>
<li class="chapter" data-level="4.4.2" data-path="using-tmb.html"><a href="using-tmb.html#forecast"><i class="fa fa-check"></i><b>4.4.2</b> Forecast</a></li>
<li class="chapter" data-level="4.4.3" data-path="using-tmb.html"><a href="using-tmb.html#global-decoding"><i class="fa fa-check"></i><b>4.4.3</b> Global decoding</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="using-tmb.html"><a href="using-tmb.html#appendix"><i class="fa fa-check"></i><b>4.5</b> Appendix</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="confidence-intervals.html"><a href="confidence-intervals.html"><i class="fa fa-check"></i><b>5</b> Confidence intervals</a>
<ul>
<li class="chapter" data-level="5.1" data-path="confidence-intervals.html"><a href="confidence-intervals.html#Wald-type"><i class="fa fa-check"></i><b>5.1</b> Wald-type confidence<br>intervals based on the Hessian</a></li>
<li class="chapter" data-level="5.2" data-path="confidence-intervals.html"><a href="confidence-intervals.html#likelihood-profile-based-confidence-intervals"><i class="fa fa-check"></i><b>5.2</b> Likelihood profile based<br>confidence intervals</a></li>
<li class="chapter" data-level="5.3" data-path="confidence-intervals.html"><a href="confidence-intervals.html#bootstrap-based-confidence-intervals"><i class="fa fa-check"></i><b>5.3</b> Bootstrap-based<br>confidence intervals</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="confidence-intervals.html"><a href="confidence-intervals.html#generating-data"><i class="fa fa-check"></i><b>5.3.1</b> Generating data</a></li>
<li class="chapter" data-level="5.3.2" data-path="confidence-intervals.html"><a href="confidence-intervals.html#bootstrap"><i class="fa fa-check"></i><b>5.3.2</b> Bootstrap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="application-to-different-data-sets.html"><a href="application-to-different-data-sets.html"><i class="fa fa-check"></i><b>6</b> Application to different data sets</a>
<ul>
<li class="chapter" data-level="6.1" data-path="application-to-different-data-sets.html"><a href="application-to-different-data-sets.html#tyt-data"><i class="fa fa-check"></i><b>6.1</b> TYT data</a></li>
<li class="chapter" data-level="6.2" data-path="application-to-different-data-sets.html"><a href="application-to-different-data-sets.html#lamb-data"><i class="fa fa-check"></i><b>6.2</b> Lamb data</a></li>
<li class="chapter" data-level="6.3" data-path="application-to-different-data-sets.html"><a href="application-to-different-data-sets.html#simulated-data"><i class="fa fa-check"></i><b>6.3</b> Simulated data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html"><i class="fa fa-check"></i><b>7</b> Gaussian HMM</a>
<ul>
<li class="chapter" data-level="7.1" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html#dataset"><i class="fa fa-check"></i><b>7.1</b> Dataset</a></li>
<li class="chapter" data-level="7.2" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html#likelihood-function-1"><i class="fa fa-check"></i><b>7.2</b> Likelihood function</a></li>
<li class="chapter" data-level="7.3" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html#estimation"><i class="fa fa-check"></i><b>7.3</b> Estimation</a></li>
<li class="chapter" data-level="7.4" data-path="gaussian-hmm.html"><a href="gaussian-hmm.html#results"><i class="fa fa-check"></i><b>7.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html"><i class="fa fa-check"></i><b>8</b> Multivariate Gaussian HMM</a>
<ul>
<li class="chapter" data-level="8.1" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#dataset-parameters"><i class="fa fa-check"></i><b>8.1</b> Dataset &amp; Parameters</a></li>
<li class="chapter" data-level="8.2" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#likelihood-function-2"><i class="fa fa-check"></i><b>8.2</b> Likelihood function</a></li>
<li class="chapter" data-level="8.3" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#estimation-1"><i class="fa fa-check"></i><b>8.3</b> Estimation</a></li>
<li class="chapter" data-level="8.4" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#results-1"><i class="fa fa-check"></i><b>8.4</b> Results</a></li>
<li class="chapter" data-level="8.5" data-path="multivariate-gaussian-hmm.html"><a href="multivariate-gaussian-hmm.html#bias"><i class="fa fa-check"></i><b>8.5</b> Bias</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>9</b> GitHub</a>
<ul>
<li class="chapter" data-level="9.1" data-path="github.html"><a href="github.html#directory-structure"><i class="fa fa-check"></i><b>9.1</b> Directory structure</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="github.html"><a href="github.html#code"><i class="fa fa-check"></i><b>9.1.1</b> code/</a></li>
<li class="chapter" data-level="9.1.2" data-path="github.html"><a href="github.html#linreg.cpp"><i class="fa fa-check"></i><b>9.1.2</b> code/linreg.cpp</a></li>
<li class="chapter" data-level="9.1.3" data-path="github.html"><a href="github.html#linreg_extended.cpp"><i class="fa fa-check"></i><b>9.1.3</b> code/linreg_extended.cpp</a></li>
<li class="chapter" data-level="9.1.4" data-path="github.html"><a href="github.html#main.R"><i class="fa fa-check"></i><b>9.1.4</b> code/main.R</a></li>
<li class="chapter" data-level="9.1.5" data-path="github.html"><a href="github.html#mvnorm_hmm.cpp"><i class="fa fa-check"></i><b>9.1.5</b> code/mvnorm_hmm.cpp</a></li>
<li class="chapter" data-level="9.1.6" data-path="github.html"><a href="github.html#norm_hmm.cpp"><i class="fa fa-check"></i><b>9.1.6</b> code/norm_hmm.cpp</a></li>
<li class="chapter" data-level="9.1.7" data-path="github.html"><a href="github.html#codepackages.r"><i class="fa fa-check"></i><b>9.1.7</b> code/packages.R</a></li>
<li class="chapter" data-level="9.1.8" data-path="github.html"><a href="github.html#poi_hmm.cpp"><i class="fa fa-check"></i><b>9.1.8</b> code/poi_hmm.cpp</a></li>
<li class="chapter" data-level="9.1.9" data-path="github.html"><a href="github.html#poi_hmm_simu1.R"><i class="fa fa-check"></i><b>9.1.9</b> code/poi_hmm_simu1.R</a></li>
<li class="chapter" data-level="9.1.10" data-path="github.html"><a href="github.html#poi_hmm_simu2.R"><i class="fa fa-check"></i><b>9.1.10</b> code/poi_hmm_simu2.R</a></li>
<li class="chapter" data-level="9.1.11" data-path="github.html"><a href="github.html#poi_hmm_simu3.R"><i class="fa fa-check"></i><b>9.1.11</b> code/poi_hmm_simu3.R</a></li>
<li class="chapter" data-level="9.1.12" data-path="github.html"><a href="github.html#poi_hmm_simu4.R"><i class="fa fa-check"></i><b>9.1.12</b> code/poi_hmm_simu3.R</a></li>
<li class="chapter" data-level="9.1.13" data-path="github.html"><a href="github.html#poi_hmm_tinn.R"><i class="fa fa-check"></i><b>9.1.13</b> code/poi_hmm_tinn.R</a></li>
<li class="chapter" data-level="9.1.14" data-path="github.html"><a href="github.html#setup_parameters.R"><i class="fa fa-check"></i><b>9.1.14</b> code/setup_parameters.R</a></li>
<li class="chapter" data-level="9.1.15" data-path="github.html"><a href="github.html#data"><i class="fa fa-check"></i><b>9.1.15</b> data/</a></li>
<li class="chapter" data-level="9.1.16" data-path="github.html"><a href="github.html#fetal-lamb.RData"><i class="fa fa-check"></i><b>9.1.16</b> data/fetal-lamb.RData</a></li>
<li class="chapter" data-level="9.1.17" data-path="github.html"><a href="github.html#dataresults_lamb.rdata"><i class="fa fa-check"></i><b>9.1.17</b> data/results_lamb.RData</a></li>
<li class="chapter" data-level="9.1.18" data-path="github.html"><a href="github.html#dataresults_simu1.rdata"><i class="fa fa-check"></i><b>9.1.18</b> data/results_simu1.RData</a></li>
<li class="chapter" data-level="9.1.19" data-path="github.html"><a href="github.html#dataresults_simu2.rdata"><i class="fa fa-check"></i><b>9.1.19</b> data/results_simu2.RData</a></li>
<li class="chapter" data-level="9.1.20" data-path="github.html"><a href="github.html#dataresults_tinn.rdata"><i class="fa fa-check"></i><b>9.1.20</b> data/results_tinn.RData</a></li>
<li class="chapter" data-level="9.1.21" data-path="github.html"><a href="github.html#tinnitus.RData"><i class="fa fa-check"></i><b>9.1.21</b> data/tinnitus.RData</a></li>
<li class="chapter" data-level="9.1.22" data-path="github.html"><a href="github.html#functions"><i class="fa fa-check"></i><b>9.1.22</b> functions/</a></li>
<li class="chapter" data-level="9.1.23" data-path="github.html"><a href="github.html#mvnorm_utils.cpp"><i class="fa fa-check"></i><b>9.1.23</b> functions/mvnorm_utils.cpp</a></li>
<li class="chapter" data-level="9.1.24" data-path="github.html"><a href="github.html#mvnorm_utils.R"><i class="fa fa-check"></i><b>9.1.24</b> functions/mvnorm_utils.R</a></li>
<li class="chapter" data-level="9.1.25" data-path="github.html"><a href="github.html#norm_utils.cpp"><i class="fa fa-check"></i><b>9.1.25</b> functions/norm_utils.cpp</a></li>
<li class="chapter" data-level="9.1.26" data-path="github.html"><a href="github.html#norm_utils.R"><i class="fa fa-check"></i><b>9.1.26</b> functions/norm_utils.R</a></li>
<li class="chapter" data-level="9.1.27" data-path="github.html"><a href="github.html#utils.cpp"><i class="fa fa-check"></i><b>9.1.27</b> functions/utils.cpp</a></li>
<li class="chapter" data-level="9.1.28" data-path="github.html"><a href="github.html#utils.R"><i class="fa fa-check"></i><b>9.1.28</b> functions/utils.R</a></li>
<li class="chapter" data-level="9.1.29" data-path="github.html"><a href="github.html#utils.R-explanation.R"><i class="fa fa-check"></i><b>9.1.29</b> functions/utils.R-explanation.R</a></li>
<li class="chapter" data-level="9.1.30" data-path="github.html"><a href="github.html#utils_linreg_extended.cpp"><i class="fa fa-check"></i><b>9.1.30</b> functions/utils_linreg_extended.cpp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A gentle tutorial of accelerated parameter and confidence interval estimation for Hidden Markov Models using Template Model Builder</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multivariate-gaussian-hmm" class="section level1" number="8">
<h1><span class="header-section-number"> 8</span> Multivariate Gaussian HMM</h1>
<p>Multivariate Gaussian HMMs with <code>TMB</code> are very similar to the previous Poisson HMM.
The main changes are the distribution parameters being changed from <span class="math inline">\({\boldsymbol\lambda}\)</span> to <span class="math inline">\({\boldsymbol\mu}\)</span> and <span class="math inline">\({\boldsymbol\Sigma}\)</span>.
In turn, these cause the density function to change from <code>dpois</code> to <code>dmvnorm</code> (and from <code>rpois</code> to <code>rmvnorm</code> for simulations) from the <code>mvtnorm</code> <span class="citation">(<a href="#ref-R-mvtnorm" role="doc-biblioref">Genz, Bretz, Miwa, Mi, &amp; Hothorn, 2021</a>)</span> package.</p>
<p>Many functions available in <em><a href="github.html#utils.R">functions/utils.R</a></em> have been adapted for the multivariate Gaussian case in <em><a href="github.html#mvnorm_utils.R">functions/mvnorm_utils.R</a></em>.</p>
<p>We detail below an example of a two-state trivariate Gaussian HMM with TMB.</p>
<div id="dataset-parameters" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Dataset &amp; Parameters</h2>
<p>To avoid issues regarding the choice of data, we simulate our own.</p>
<p>The parameters chosen are as follows
<span class="math display">\[\begin{equation*}
{\boldsymbol\Gamma} =
\begin{pmatrix}
0.85 &amp; 0.05 &amp; 0.05 &amp; 0.05\\
0.05 &amp; 0.85 &amp; 0.05 &amp; 0.05\\
0.05 &amp; 0.10 &amp; 0.80 &amp; 0.05\\
0.25 &amp; 0.25 &amp; 0.25 &amp; 0.25
\end{pmatrix}, \quad
{\boldsymbol\lambda} = (1, 6, 11, 16)
\end{equation*}\]</span></p>
<p>We generate 1000 data with the function below (similarly to the Poisson case).</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="multivariate-gaussian-hmm.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a random sample from a HMM</span></span>
<span id="cb90-2"><a href="multivariate-gaussian-hmm.html#cb90-2" aria-hidden="true" tabindex="-1"></a>mvnorm.HMM.generate.sample  <span class="ot">&lt;-</span> <span class="cf">function</span>(ns, mod) {</span>
<span id="cb90-3"><a href="multivariate-gaussian-hmm.html#cb90-3" aria-hidden="true" tabindex="-1"></a>  mvect <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>mod<span class="sc">$</span>m</span>
<span id="cb90-4"><a href="multivariate-gaussian-hmm.html#cb90-4" aria-hidden="true" tabindex="-1"></a>  state <span class="ot">&lt;-</span> <span class="fu">numeric</span>(ns)</span>
<span id="cb90-5"><a href="multivariate-gaussian-hmm.html#cb90-5" aria-hidden="true" tabindex="-1"></a>  state[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sample</span>(mvect, <span class="dv">1</span>, <span class="at">prob =</span> mod<span class="sc">$</span>delta)</span>
<span id="cb90-6"><a href="multivariate-gaussian-hmm.html#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>ns) {</span>
<span id="cb90-7"><a href="multivariate-gaussian-hmm.html#cb90-7" aria-hidden="true" tabindex="-1"></a>    state[i] <span class="ot">&lt;-</span> <span class="fu">sample</span>(mvect, <span class="dv">1</span>, <span class="at">prob =</span> mod<span class="sc">$</span>gamma[state[i <span class="sc">-</span> <span class="dv">1</span>], ])</span>
<span id="cb90-8"><a href="multivariate-gaussian-hmm.html#cb90-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-9"><a href="multivariate-gaussian-hmm.html#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x &lt;- rpois(ns, lambda = mod$lambda[state])</span></span>
<span id="cb90-10"><a href="multivariate-gaussian-hmm.html#cb90-10" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ns, <span class="at">ncol =</span> p)</span>
<span id="cb90-11"><a href="multivariate-gaussian-hmm.html#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ns) {</span>
<span id="cb90-12"><a href="multivariate-gaussian-hmm.html#cb90-12" aria-hidden="true" tabindex="-1"></a>    x[i, ] <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(<span class="at">n =</span> <span class="dv">1</span>,</span>
<span id="cb90-13"><a href="multivariate-gaussian-hmm.html#cb90-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mean =</span> mod<span class="sc">$</span>mu[state[i], ],</span>
<span id="cb90-14"><a href="multivariate-gaussian-hmm.html#cb90-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sigma =</span> mod<span class="sc">$</span>sigma[, , state[i]])</span>
<span id="cb90-15"><a href="multivariate-gaussian-hmm.html#cb90-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-16"><a href="multivariate-gaussian-hmm.html#cb90-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-17"><a href="multivariate-gaussian-hmm.html#cb90-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(x) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb90-18"><a href="multivariate-gaussian-hmm.html#cb90-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">data =</span> x, <span class="at">state =</span> state))</span>
<span id="cb90-19"><a href="multivariate-gaussian-hmm.html#cb90-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="likelihood-function-2" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Likelihood function</h2>
<p>The Gaussian negative log-likelihood in TMB can be coded as</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb91-1"><a href="multivariate-gaussian-hmm.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;TMB.hpp&gt;</span></span>
<span id="cb91-2"><a href="multivariate-gaussian-hmm.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;../functions/norm_utils.cpp&quot;</span></span>
<span id="cb91-3"><a href="multivariate-gaussian-hmm.html#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="multivariate-gaussian-hmm.html#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Likelihood for a normal hidden markov model. </span></span>
<span id="cb91-5"><a href="multivariate-gaussian-hmm.html#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb91-6"><a href="multivariate-gaussian-hmm.html#cb91-6" aria-hidden="true" tabindex="-1"></a>Type objective_function<span class="op">&lt;</span>Type<span class="op">&gt;::</span><span class="kw">operator</span><span class="op">()</span> <span class="op">()</span></span>
<span id="cb91-7"><a href="multivariate-gaussian-hmm.html#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb91-8"><a href="multivariate-gaussian-hmm.html#cb91-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-9"><a href="multivariate-gaussian-hmm.html#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Data</span></span>
<span id="cb91-10"><a href="multivariate-gaussian-hmm.html#cb91-10" aria-hidden="true" tabindex="-1"></a>  DATA_VECTOR<span class="op">(</span>x<span class="op">);</span>          <span class="co">// timeseries vector</span></span>
<span id="cb91-11"><a href="multivariate-gaussian-hmm.html#cb91-11" aria-hidden="true" tabindex="-1"></a>  DATA_INTEGER<span class="op">(</span>m<span class="op">);</span>         <span class="co">// Number of states m</span></span>
<span id="cb91-12"><a href="multivariate-gaussian-hmm.html#cb91-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-13"><a href="multivariate-gaussian-hmm.html#cb91-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Parameters</span></span>
<span id="cb91-14"><a href="multivariate-gaussian-hmm.html#cb91-14" aria-hidden="true" tabindex="-1"></a>  PARAMETER_VECTOR<span class="op">(</span>tmu<span class="op">);</span>            <span class="co">// conditional means</span></span>
<span id="cb91-15"><a href="multivariate-gaussian-hmm.html#cb91-15" aria-hidden="true" tabindex="-1"></a>  PARAMETER_VECTOR<span class="op">(</span>tsigma<span class="op">);</span>         <span class="co">// conditional log_sd&#39;s</span></span>
<span id="cb91-16"><a href="multivariate-gaussian-hmm.html#cb91-16" aria-hidden="true" tabindex="-1"></a>  PARAMETER_VECTOR<span class="op">(</span>tgamma<span class="op">);</span>         <span class="co">// m(m-1) working parameters of TPM</span></span>
<span id="cb91-17"><a href="multivariate-gaussian-hmm.html#cb91-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// PARAMETER_VECTOR(tdelta);      // m-1 working parameters of initial distribution</span></span>
<span id="cb91-18"><a href="multivariate-gaussian-hmm.html#cb91-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-19"><a href="multivariate-gaussian-hmm.html#cb91-19" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb91-20"><a href="multivariate-gaussian-hmm.html#cb91-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Transform working parameters to natural parameters:</span></span>
<span id="cb91-21"><a href="multivariate-gaussian-hmm.html#cb91-21" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> mu <span class="op">=</span> tmu<span class="op">;</span></span>
<span id="cb91-22"><a href="multivariate-gaussian-hmm.html#cb91-22" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> sigma <span class="op">=</span> tsigma<span class="op">.</span>exp<span class="op">();</span></span>
<span id="cb91-23"><a href="multivariate-gaussian-hmm.html#cb91-23" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> gamma <span class="op">=</span> gamma_w2n<span class="op">(</span>m<span class="op">,</span> tgamma<span class="op">);</span></span>
<span id="cb91-24"><a href="multivariate-gaussian-hmm.html#cb91-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// vector&lt;Type&gt; delta = delta_w2n(m, tdelta);</span></span>
<span id="cb91-25"><a href="multivariate-gaussian-hmm.html#cb91-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-26"><a href="multivariate-gaussian-hmm.html#cb91-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Construct stationary distribution </span></span>
<span id="cb91-27"><a href="multivariate-gaussian-hmm.html#cb91-27" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> delta <span class="op">=</span> stat_dist<span class="op">(</span>m<span class="op">,</span> gamma<span class="op">);</span></span>
<span id="cb91-28"><a href="multivariate-gaussian-hmm.html#cb91-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-29"><a href="multivariate-gaussian-hmm.html#cb91-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get number of timesteps (n)</span></span>
<span id="cb91-30"><a href="multivariate-gaussian-hmm.html#cb91-30" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n <span class="op">=</span> x<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb91-31"><a href="multivariate-gaussian-hmm.html#cb91-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-32"><a href="multivariate-gaussian-hmm.html#cb91-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Evaluate conditional distribution: Put conditional probabilities</span></span>
<span id="cb91-33"><a href="multivariate-gaussian-hmm.html#cb91-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">// of observed x in n times m matrix (one column for each state)</span></span>
<span id="cb91-34"><a href="multivariate-gaussian-hmm.html#cb91-34" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> emission_probs<span class="op">(</span>n<span class="op">,</span> m<span class="op">);</span></span>
<span id="cb91-35"><a href="multivariate-gaussian-hmm.html#cb91-35" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> row1vec<span class="op">(</span><span class="dv">1</span><span class="op">,</span> m<span class="op">);</span></span>
<span id="cb91-36"><a href="multivariate-gaussian-hmm.html#cb91-36" aria-hidden="true" tabindex="-1"></a>  row1vec<span class="op">.</span>setOnes<span class="op">();</span></span>
<span id="cb91-37"><a href="multivariate-gaussian-hmm.html#cb91-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb91-38"><a href="multivariate-gaussian-hmm.html#cb91-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">[</span>i<span class="op">]</span> <span class="op">!=</span> x<span class="op">[</span>i<span class="op">])</span> <span class="op">{</span> <span class="co">// f != f returns true if and only if f is NaN. </span></span>
<span id="cb91-39"><a href="multivariate-gaussian-hmm.html#cb91-39" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Replace missing values (NA in R, NaN in C++) with 1</span></span>
<span id="cb91-40"><a href="multivariate-gaussian-hmm.html#cb91-40" aria-hidden="true" tabindex="-1"></a>      emission_probs<span class="op">.</span>row<span class="op">(</span>i<span class="op">)</span> <span class="op">=</span> row1vec<span class="op">;</span></span>
<span id="cb91-41"><a href="multivariate-gaussian-hmm.html#cb91-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-42"><a href="multivariate-gaussian-hmm.html#cb91-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb91-43"><a href="multivariate-gaussian-hmm.html#cb91-43" aria-hidden="true" tabindex="-1"></a>      emission_probs<span class="op">.</span>row<span class="op">(</span>i<span class="op">)</span> <span class="op">=</span> dnorm<span class="op">(</span>x<span class="op">(</span>i<span class="op">),</span> mu<span class="op">,</span> sigma<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb91-44"><a href="multivariate-gaussian-hmm.html#cb91-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-45"><a href="multivariate-gaussian-hmm.html#cb91-45" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb91-46"><a href="multivariate-gaussian-hmm.html#cb91-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-47"><a href="multivariate-gaussian-hmm.html#cb91-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Corresponds to the book page 333</span></span>
<span id="cb91-48"><a href="multivariate-gaussian-hmm.html#cb91-48" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> foo<span class="op">,</span> P<span class="op">;</span></span>
<span id="cb91-49"><a href="multivariate-gaussian-hmm.html#cb91-49" aria-hidden="true" tabindex="-1"></a>  Type mllk<span class="op">,</span> sumfoo<span class="op">,</span> lscale<span class="op">;</span></span>
<span id="cb91-50"><a href="multivariate-gaussian-hmm.html#cb91-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-51"><a href="multivariate-gaussian-hmm.html#cb91-51" aria-hidden="true" tabindex="-1"></a>  foo <span class="op">=</span> <span class="op">(</span>delta <span class="op">*</span> vector<span class="op">&lt;</span>Type<span class="op">&gt;(</span>emission_probs<span class="op">.</span>row<span class="op">(</span><span class="dv">0</span><span class="op">))).</span>matrix<span class="op">();</span></span>
<span id="cb91-52"><a href="multivariate-gaussian-hmm.html#cb91-52" aria-hidden="true" tabindex="-1"></a>  sumfoo <span class="op">=</span> foo<span class="op">.</span>sum<span class="op">();</span></span>
<span id="cb91-53"><a href="multivariate-gaussian-hmm.html#cb91-53" aria-hidden="true" tabindex="-1"></a>  lscale <span class="op">=</span> log<span class="op">(</span>sumfoo<span class="op">);</span></span>
<span id="cb91-54"><a href="multivariate-gaussian-hmm.html#cb91-54" aria-hidden="true" tabindex="-1"></a>  foo<span class="op">.</span>transposeInPlace<span class="op">();</span></span>
<span id="cb91-55"><a href="multivariate-gaussian-hmm.html#cb91-55" aria-hidden="true" tabindex="-1"></a>  foo <span class="op">/=</span> sumfoo<span class="op">;</span></span>
<span id="cb91-56"><a href="multivariate-gaussian-hmm.html#cb91-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb91-57"><a href="multivariate-gaussian-hmm.html#cb91-57" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> emission_probs<span class="op">.</span>row<span class="op">(</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb91-58"><a href="multivariate-gaussian-hmm.html#cb91-58" aria-hidden="true" tabindex="-1"></a>    foo <span class="op">=</span> <span class="op">((</span>foo <span class="op">*</span> gamma<span class="op">).</span>array<span class="op">()</span> <span class="op">*</span> P<span class="op">.</span>array<span class="op">()).</span>matrix<span class="op">();</span></span>
<span id="cb91-59"><a href="multivariate-gaussian-hmm.html#cb91-59" aria-hidden="true" tabindex="-1"></a>    sumfoo <span class="op">=</span> foo<span class="op">.</span>sum<span class="op">();</span></span>
<span id="cb91-60"><a href="multivariate-gaussian-hmm.html#cb91-60" aria-hidden="true" tabindex="-1"></a>    lscale <span class="op">+=</span> log<span class="op">(</span>sumfoo<span class="op">);</span></span>
<span id="cb91-61"><a href="multivariate-gaussian-hmm.html#cb91-61" aria-hidden="true" tabindex="-1"></a>    foo <span class="op">/=</span> sumfoo<span class="op">;</span></span>
<span id="cb91-62"><a href="multivariate-gaussian-hmm.html#cb91-62" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb91-63"><a href="multivariate-gaussian-hmm.html#cb91-63" aria-hidden="true" tabindex="-1"></a>  mllk <span class="op">=</span> <span class="op">-</span>lscale<span class="op">;</span></span>
<span id="cb91-64"><a href="multivariate-gaussian-hmm.html#cb91-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-65"><a href="multivariate-gaussian-hmm.html#cb91-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Use adreport on variables for which we want standard errors</span></span>
<span id="cb91-66"><a href="multivariate-gaussian-hmm.html#cb91-66" aria-hidden="true" tabindex="-1"></a>  ADREPORT<span class="op">(</span>mu<span class="op">);</span></span>
<span id="cb91-67"><a href="multivariate-gaussian-hmm.html#cb91-67" aria-hidden="true" tabindex="-1"></a>  ADREPORT<span class="op">(</span>sigma<span class="op">);</span></span>
<span id="cb91-68"><a href="multivariate-gaussian-hmm.html#cb91-68" aria-hidden="true" tabindex="-1"></a>  ADREPORT<span class="op">(</span>gamma<span class="op">);</span></span>
<span id="cb91-69"><a href="multivariate-gaussian-hmm.html#cb91-69" aria-hidden="true" tabindex="-1"></a>  ADREPORT<span class="op">(</span>delta<span class="op">);</span></span>
<span id="cb91-70"><a href="multivariate-gaussian-hmm.html#cb91-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-71"><a href="multivariate-gaussian-hmm.html#cb91-71" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Variables we need for local decoding and in a convenient format</span></span>
<span id="cb91-72"><a href="multivariate-gaussian-hmm.html#cb91-72" aria-hidden="true" tabindex="-1"></a>  REPORT<span class="op">(</span>mu<span class="op">);</span></span>
<span id="cb91-73"><a href="multivariate-gaussian-hmm.html#cb91-73" aria-hidden="true" tabindex="-1"></a>  REPORT<span class="op">(</span>sigma<span class="op">);</span></span>
<span id="cb91-74"><a href="multivariate-gaussian-hmm.html#cb91-74" aria-hidden="true" tabindex="-1"></a>  REPORT<span class="op">(</span>gamma<span class="op">);</span></span>
<span id="cb91-75"><a href="multivariate-gaussian-hmm.html#cb91-75" aria-hidden="true" tabindex="-1"></a>  REPORT<span class="op">(</span>delta<span class="op">);</span></span>
<span id="cb91-76"><a href="multivariate-gaussian-hmm.html#cb91-76" aria-hidden="true" tabindex="-1"></a>  REPORT<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb91-77"><a href="multivariate-gaussian-hmm.html#cb91-77" aria-hidden="true" tabindex="-1"></a>  <span class="co">// REPORT(emission_probs);</span></span>
<span id="cb91-78"><a href="multivariate-gaussian-hmm.html#cb91-78" aria-hidden="true" tabindex="-1"></a>  REPORT<span class="op">(</span>mllk<span class="op">);</span></span>
<span id="cb91-79"><a href="multivariate-gaussian-hmm.html#cb91-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-80"><a href="multivariate-gaussian-hmm.html#cb91-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> mllk<span class="op">;</span></span>
<span id="cb91-81"><a href="multivariate-gaussian-hmm.html#cb91-81" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>and requires the following utility functions.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb92-1"><a href="multivariate-gaussian-hmm.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Function transforming working parameters in initial distribution</span></span>
<span id="cb92-2"><a href="multivariate-gaussian-hmm.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co">// to natural parameters</span></span>
<span id="cb92-3"><a href="multivariate-gaussian-hmm.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb92-4"><a href="multivariate-gaussian-hmm.html#cb92-4" aria-hidden="true" tabindex="-1"></a>vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> delta_w2n<span class="op">(</span><span class="dt">int</span> m<span class="op">,</span> vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> tdelta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-5"><a href="multivariate-gaussian-hmm.html#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="multivariate-gaussian-hmm.html#cb92-6" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> delta<span class="op">(</span>m<span class="op">);</span></span>
<span id="cb92-7"><a href="multivariate-gaussian-hmm.html#cb92-7" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> foo<span class="op">(</span>m<span class="op">);</span></span>
<span id="cb92-8"><a href="multivariate-gaussian-hmm.html#cb92-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-9"><a href="multivariate-gaussian-hmm.html#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>m <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb92-10"><a href="multivariate-gaussian-hmm.html#cb92-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Type<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb92-11"><a href="multivariate-gaussian-hmm.html#cb92-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-12"><a href="multivariate-gaussian-hmm.html#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// set first element to one.</span></span>
<span id="cb92-13"><a href="multivariate-gaussian-hmm.html#cb92-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Fill in the last m - 1 elements with working parameters</span></span>
<span id="cb92-14"><a href="multivariate-gaussian-hmm.html#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// and take exponential</span></span>
<span id="cb92-15"><a href="multivariate-gaussian-hmm.html#cb92-15" aria-hidden="true" tabindex="-1"></a>  foo <span class="op">&lt;&lt;</span> Type<span class="op">(</span><span class="dv">1</span><span class="op">),</span> tdelta<span class="op">.</span>exp<span class="op">();</span></span>
<span id="cb92-16"><a href="multivariate-gaussian-hmm.html#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="multivariate-gaussian-hmm.html#cb92-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// normalize</span></span>
<span id="cb92-18"><a href="multivariate-gaussian-hmm.html#cb92-18" aria-hidden="true" tabindex="-1"></a>  delta <span class="op">=</span> foo <span class="op">/</span> foo<span class="op">.</span>sum<span class="op">();</span></span>
<span id="cb92-19"><a href="multivariate-gaussian-hmm.html#cb92-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-20"><a href="multivariate-gaussian-hmm.html#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> delta<span class="op">;</span></span>
<span id="cb92-21"><a href="multivariate-gaussian-hmm.html#cb92-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-22"><a href="multivariate-gaussian-hmm.html#cb92-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-23"><a href="multivariate-gaussian-hmm.html#cb92-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Function transforming the working parameters in TPM to</span></span>
<span id="cb92-24"><a href="multivariate-gaussian-hmm.html#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="co">// natural parameters (w2n)</span></span>
<span id="cb92-25"><a href="multivariate-gaussian-hmm.html#cb92-25" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb92-26"><a href="multivariate-gaussian-hmm.html#cb92-26" aria-hidden="true" tabindex="-1"></a>matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> gamma_w2n<span class="op">(</span><span class="dt">int</span> m<span class="op">,</span> vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> tgamma<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-27"><a href="multivariate-gaussian-hmm.html#cb92-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-28"><a href="multivariate-gaussian-hmm.html#cb92-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Construct m x m identity matrix</span></span>
<span id="cb92-29"><a href="multivariate-gaussian-hmm.html#cb92-29" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> gamma<span class="op">(</span>m<span class="op">,</span> m<span class="op">);</span></span>
<span id="cb92-30"><a href="multivariate-gaussian-hmm.html#cb92-30" aria-hidden="true" tabindex="-1"></a>  gamma<span class="op">.</span>setIdentity<span class="op">();</span></span>
<span id="cb92-31"><a href="multivariate-gaussian-hmm.html#cb92-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-32"><a href="multivariate-gaussian-hmm.html#cb92-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>m <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb92-33"><a href="multivariate-gaussian-hmm.html#cb92-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gamma<span class="op">;</span></span>
<span id="cb92-34"><a href="multivariate-gaussian-hmm.html#cb92-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-35"><a href="multivariate-gaussian-hmm.html#cb92-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Fill offdiagonal elements with working parameters column-wise:</span></span>
<span id="cb92-36"><a href="multivariate-gaussian-hmm.html#cb92-36" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> idx <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb92-37"><a href="multivariate-gaussian-hmm.html#cb92-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m<span class="op">;</span> i<span class="op">++){</span></span>
<span id="cb92-38"><a href="multivariate-gaussian-hmm.html#cb92-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> m<span class="op">;</span> j<span class="op">++){</span></span>
<span id="cb92-39"><a href="multivariate-gaussian-hmm.html#cb92-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>j <span class="op">!=</span> i<span class="op">){</span></span>
<span id="cb92-40"><a href="multivariate-gaussian-hmm.html#cb92-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fill gamma according to mapping and take exponential</span></span>
<span id="cb92-41"><a href="multivariate-gaussian-hmm.html#cb92-41" aria-hidden="true" tabindex="-1"></a>        gamma<span class="op">(</span>j<span class="op">,</span> i<span class="op">)</span> <span class="op">=</span> tgamma<span class="op">.</span>exp<span class="op">()(</span>idx<span class="op">);</span></span>
<span id="cb92-42"><a href="multivariate-gaussian-hmm.html#cb92-42" aria-hidden="true" tabindex="-1"></a>        idx<span class="op">++;</span></span>
<span id="cb92-43"><a href="multivariate-gaussian-hmm.html#cb92-43" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb92-44"><a href="multivariate-gaussian-hmm.html#cb92-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-45"><a href="multivariate-gaussian-hmm.html#cb92-45" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb92-46"><a href="multivariate-gaussian-hmm.html#cb92-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Normalize each row:</span></span>
<span id="cb92-47"><a href="multivariate-gaussian-hmm.html#cb92-47" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> cs <span class="op">=</span> gamma<span class="op">.</span>rowwise<span class="op">().</span>sum<span class="op">();</span></span>
<span id="cb92-48"><a href="multivariate-gaussian-hmm.html#cb92-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m<span class="op">;</span> i<span class="op">++)</span> gamma<span class="op">.</span>row<span class="op">(</span>i<span class="op">)</span> <span class="op">/=</span> cs<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb92-49"><a href="multivariate-gaussian-hmm.html#cb92-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-50"><a href="multivariate-gaussian-hmm.html#cb92-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> gamma<span class="op">;</span></span>
<span id="cb92-51"><a href="multivariate-gaussian-hmm.html#cb92-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-52"><a href="multivariate-gaussian-hmm.html#cb92-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-53"><a href="multivariate-gaussian-hmm.html#cb92-53" aria-hidden="true" tabindex="-1"></a><span class="co">// Function computing the stationary distribution of a Markov chain</span></span>
<span id="cb92-54"><a href="multivariate-gaussian-hmm.html#cb92-54" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb92-55"><a href="multivariate-gaussian-hmm.html#cb92-55" aria-hidden="true" tabindex="-1"></a>vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> stat_dist<span class="op">(</span><span class="dt">int</span> m<span class="op">,</span> matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> gamma<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-56"><a href="multivariate-gaussian-hmm.html#cb92-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-57"><a href="multivariate-gaussian-hmm.html#cb92-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Construct stationary distribution</span></span>
<span id="cb92-58"><a href="multivariate-gaussian-hmm.html#cb92-58" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> I<span class="op">(</span>m<span class="op">,</span> m<span class="op">);</span></span>
<span id="cb92-59"><a href="multivariate-gaussian-hmm.html#cb92-59" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> U<span class="op">(</span>m<span class="op">,</span> m<span class="op">);</span></span>
<span id="cb92-60"><a href="multivariate-gaussian-hmm.html#cb92-60" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> row1vec<span class="op">(</span><span class="dv">1</span><span class="op">,</span> m<span class="op">);</span></span>
<span id="cb92-61"><a href="multivariate-gaussian-hmm.html#cb92-61" aria-hidden="true" tabindex="-1"></a>  U <span class="op">=</span> U<span class="op">.</span>setOnes<span class="op">();</span></span>
<span id="cb92-62"><a href="multivariate-gaussian-hmm.html#cb92-62" aria-hidden="true" tabindex="-1"></a>  I <span class="op">=</span> I<span class="op">.</span>setIdentity<span class="op">();</span></span>
<span id="cb92-63"><a href="multivariate-gaussian-hmm.html#cb92-63" aria-hidden="true" tabindex="-1"></a>  row1vec<span class="op">.</span>setOnes<span class="op">();</span></span>
<span id="cb92-64"><a href="multivariate-gaussian-hmm.html#cb92-64" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> A <span class="op">=</span>  I <span class="op">-</span> gamma <span class="op">+</span> U<span class="op">;</span></span>
<span id="cb92-65"><a href="multivariate-gaussian-hmm.html#cb92-65" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> Ainv <span class="op">=</span> A<span class="op">.</span>inverse<span class="op">();</span></span>
<span id="cb92-66"><a href="multivariate-gaussian-hmm.html#cb92-66" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">&lt;</span>Type<span class="op">&gt;</span> deltamat <span class="op">=</span> row1vec <span class="op">*</span> Ainv<span class="op">;</span></span>
<span id="cb92-67"><a href="multivariate-gaussian-hmm.html#cb92-67" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> delta <span class="op">=</span> deltamat<span class="op">.</span>row<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb92-68"><a href="multivariate-gaussian-hmm.html#cb92-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-69"><a href="multivariate-gaussian-hmm.html#cb92-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> delta<span class="op">;</span></span>
<span id="cb92-70"><a href="multivariate-gaussian-hmm.html#cb92-70" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="estimation-1" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Estimation</h2>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="multivariate-gaussian-hmm.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;code/packages.R&quot;</span>)</span>
<span id="cb93-2"><a href="multivariate-gaussian-hmm.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions/mvnorm_utils.R&quot;</span>)</span>
<span id="cb93-3"><a href="multivariate-gaussian-hmm.html#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="multivariate-gaussian-hmm.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># TMB::precompile()</span></span>
<span id="cb93-5"><a href="multivariate-gaussian-hmm.html#cb93-5" aria-hidden="true" tabindex="-1"></a>TMB<span class="sc">::</span><span class="fu">compile</span>(<span class="st">&quot;code/mvnorm_hmm.cpp&quot;</span>)</span>
<span id="cb93-6"><a href="multivariate-gaussian-hmm.html#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span>
<span id="cb93-7"><a href="multivariate-gaussian-hmm.html#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dyn.load</span>(TMB<span class="sc">::</span><span class="fu">dynlib</span>(<span class="st">&quot;code/mvnorm_hmm&quot;</span>))</span>
<span id="cb93-8"><a href="multivariate-gaussian-hmm.html#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="multivariate-gaussian-hmm.html#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb93-10"><a href="multivariate-gaussian-hmm.html#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="multivariate-gaussian-hmm.html#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Two states</span></span>
<span id="cb93-12"><a href="multivariate-gaussian-hmm.html#cb93-12" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb93-13"><a href="multivariate-gaussian-hmm.html#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Trivariate Normal distribution</span></span>
<span id="cb93-14"><a href="multivariate-gaussian-hmm.html#cb93-14" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb93-15"><a href="multivariate-gaussian-hmm.html#cb93-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-16"><a href="multivariate-gaussian-hmm.html#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="co"># One row per state, one column per dimension of the data</span></span>
<span id="cb93-17"><a href="multivariate-gaussian-hmm.html#cb93-17" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">9</span>,</span>
<span id="cb93-18"><a href="multivariate-gaussian-hmm.html#cb93-18" aria-hidden="true" tabindex="-1"></a>               <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">nrow =</span> m, <span class="at">ncol =</span> p, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-19"><a href="multivariate-gaussian-hmm.html#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Two covariance matrices</span></span>
<span id="cb93-20"><a href="multivariate-gaussian-hmm.html#cb93-20" aria-hidden="true" tabindex="-1"></a>sigma1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">1.0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>,</span>
<span id="cb93-21"><a href="multivariate-gaussian-hmm.html#cb93-21" aria-hidden="true" tabindex="-1"></a>                   <span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span>,</span>
<span id="cb93-22"><a href="multivariate-gaussian-hmm.html#cb93-22" aria-hidden="true" tabindex="-1"></a>                   <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>), <span class="at">nrow =</span> p, <span class="at">ncol =</span> p, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-23"><a href="multivariate-gaussian-hmm.html#cb93-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-24"><a href="multivariate-gaussian-hmm.html#cb93-24" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">2.0</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>,</span>
<span id="cb93-25"><a href="multivariate-gaussian-hmm.html#cb93-25" aria-hidden="true" tabindex="-1"></a>                   <span class="fl">1.5</span>, <span class="fl">2.0</span>, <span class="fl">1.5</span>,</span>
<span id="cb93-26"><a href="multivariate-gaussian-hmm.html#cb93-26" aria-hidden="true" tabindex="-1"></a>                   <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">2.0</span>), <span class="at">nrow =</span> p, <span class="at">ncol =</span> p, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-27"><a href="multivariate-gaussian-hmm.html#cb93-27" aria-hidden="true" tabindex="-1"></a><span class="co"># We store them in an array for convenience, making them</span></span>
<span id="cb93-28"><a href="multivariate-gaussian-hmm.html#cb93-28" aria-hidden="true" tabindex="-1"></a><span class="co"># easily distinguishable at a glance when displayed</span></span>
<span id="cb93-29"><a href="multivariate-gaussian-hmm.html#cb93-29" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(sigma1, sigma2), <span class="at">dim =</span> <span class="fu">c</span>(p, p, m))</span>
<span id="cb93-30"><a href="multivariate-gaussian-hmm.html#cb93-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-31"><a href="multivariate-gaussian-hmm.html#cb93-31" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.95</span>, <span class="fl">0.05</span>,</span>
<span id="cb93-32"><a href="multivariate-gaussian-hmm.html#cb93-32" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">0.15</span>, <span class="fl">0.85</span>), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> m, <span class="at">ncol =</span> m)</span>
<span id="cb93-33"><a href="multivariate-gaussian-hmm.html#cb93-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-34"><a href="multivariate-gaussian-hmm.html#cb93-34" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">m =</span> m,</span>
<span id="cb93-35"><a href="multivariate-gaussian-hmm.html#cb93-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">mu =</span> mu,</span>
<span id="cb93-36"><a href="multivariate-gaussian-hmm.html#cb93-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">sigma =</span> sigma,</span>
<span id="cb93-37"><a href="multivariate-gaussian-hmm.html#cb93-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">gamma =</span> gamma)</span>
<span id="cb93-38"><a href="multivariate-gaussian-hmm.html#cb93-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-39"><a href="multivariate-gaussian-hmm.html#cb93-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Similarly to the Poisson case, we can generate data.</span></span>
<span id="cb93-40"><a href="multivariate-gaussian-hmm.html#cb93-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we generate a trivariate Gaussian sample of size 1000.</span></span>
<span id="cb93-41"><a href="multivariate-gaussian-hmm.html#cb93-41" aria-hidden="true" tabindex="-1"></a>TMBdata <span class="ot">&lt;-</span> <span class="fu">mvnorm.HMM.generate.sample</span>(<span class="dv">1000</span>, mod)</span>
<span id="cb93-42"><a href="multivariate-gaussian-hmm.html#cb93-42" aria-hidden="true" tabindex="-1"></a><span class="co"># TMB requires a list</span></span>
<span id="cb93-43"><a href="multivariate-gaussian-hmm.html#cb93-43" aria-hidden="true" tabindex="-1"></a>TMB_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> TMBdata<span class="sc">$</span>data,</span>
<span id="cb93-44"><a href="multivariate-gaussian-hmm.html#cb93-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">m =</span> m)</span>
<span id="cb93-45"><a href="multivariate-gaussian-hmm.html#cb93-45" aria-hidden="true" tabindex="-1"></a><span class="co"># TMB requires the parameters to be either vectors, matrices, or arrays.</span></span>
<span id="cb93-46"><a href="multivariate-gaussian-hmm.html#cb93-46" aria-hidden="true" tabindex="-1"></a><span class="co"># For simplicity, we pass the parameters as a list of vectors and matrices.</span></span>
<span id="cb93-47"><a href="multivariate-gaussian-hmm.html#cb93-47" aria-hidden="true" tabindex="-1"></a>pw <span class="ot">&lt;-</span> <span class="fu">mvnorm.HMM.pn2pw</span>(<span class="at">m =</span> m,</span>
<span id="cb93-48"><a href="multivariate-gaussian-hmm.html#cb93-48" aria-hidden="true" tabindex="-1"></a>                       <span class="at">mu =</span> mu, <span class="at">sigma =</span> sigma, <span class="at">gamma =</span> gamma)</span>
<span id="cb93-49"><a href="multivariate-gaussian-hmm.html#cb93-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-50"><a href="multivariate-gaussian-hmm.html#cb93-50" aria-hidden="true" tabindex="-1"></a>obj_tmb <span class="ot">&lt;-</span> TMB<span class="sc">::</span><span class="fu">MakeADFun</span>(<span class="at">data =</span> TMB_data,</span>
<span id="cb93-51"><a href="multivariate-gaussian-hmm.html#cb93-51" aria-hidden="true" tabindex="-1"></a>                          <span class="at">parameters =</span> pw,</span>
<span id="cb93-52"><a href="multivariate-gaussian-hmm.html#cb93-52" aria-hidden="true" tabindex="-1"></a>                          <span class="at">DLL =</span> <span class="st">&quot;mvnorm_hmm&quot;</span>,</span>
<span id="cb93-53"><a href="multivariate-gaussian-hmm.html#cb93-53" aria-hidden="true" tabindex="-1"></a>                          <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-54"><a href="multivariate-gaussian-hmm.html#cb93-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-55"><a href="multivariate-gaussian-hmm.html#cb93-55" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">nlminb</span>(<span class="at">start =</span> obj_tmb<span class="sc">$</span>par,</span>
<span id="cb93-56"><a href="multivariate-gaussian-hmm.html#cb93-56" aria-hidden="true" tabindex="-1"></a>              <span class="at">objective =</span> obj_tmb<span class="sc">$</span>fn,</span>
<span id="cb93-57"><a href="multivariate-gaussian-hmm.html#cb93-57" aria-hidden="true" tabindex="-1"></a>              <span class="at">gradient =</span> obj_tmb<span class="sc">$</span>gr,</span>
<span id="cb93-58"><a href="multivariate-gaussian-hmm.html#cb93-58" aria-hidden="true" tabindex="-1"></a>              <span class="at">hessian =</span> obj_tmb<span class="sc">$</span>he)</span></code></pre></div>
</div>
<div id="results-1" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Results</h2>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="multivariate-gaussian-hmm.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">sdreport</span>(obj_tmb), <span class="st">&quot;report&quot;</span>)</span>
<span id="cb94-2"><a href="multivariate-gaussian-hmm.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="do">##         Estimate  Std. Error</span></span>
<span id="cb94-3"><a href="multivariate-gaussian-hmm.html#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="do">## mu    5.97933189 0.037563682</span></span>
<span id="cb94-4"><a href="multivariate-gaussian-hmm.html#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="do">## mu    7.97466265 0.036769886</span></span>
<span id="cb94-5"><a href="multivariate-gaussian-hmm.html#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="do">## mu    9.03496308 0.036893647</span></span>
<span id="cb94-6"><a href="multivariate-gaussian-hmm.html#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="do">## mu    1.10579193 0.079577526</span></span>
<span id="cb94-7"><a href="multivariate-gaussian-hmm.html#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="do">## mu    2.01696329 0.082568262</span></span>
<span id="cb94-8"><a href="multivariate-gaussian-hmm.html#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="do">## mu    3.06944256 0.081165357</span></span>
<span id="cb94-9"><a href="multivariate-gaussian-hmm.html#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.98949937 0.052850720</span></span>
<span id="cb94-10"><a href="multivariate-gaussian-hmm.html#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.46755142 0.040689252</span></span>
<span id="cb94-11"><a href="multivariate-gaussian-hmm.html#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.45275405 0.040488620</span></span>
<span id="cb94-12"><a href="multivariate-gaussian-hmm.html#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.46755142 0.040689252</span></span>
<span id="cb94-13"><a href="multivariate-gaussian-hmm.html#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.94526437 0.050668944</span></span>
<span id="cb94-14"><a href="multivariate-gaussian-hmm.html#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.47948079 0.040495684</span></span>
<span id="cb94-15"><a href="multivariate-gaussian-hmm.html#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.45275405 0.040488620</span></span>
<span id="cb94-16"><a href="multivariate-gaussian-hmm.html#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.47948079 0.040495684</span></span>
<span id="cb94-17"><a href="multivariate-gaussian-hmm.html#cb94-17" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 0.94984027 0.051242766</span></span>
<span id="cb94-18"><a href="multivariate-gaussian-hmm.html#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 1.84609954 0.155927347</span></span>
<span id="cb94-19"><a href="multivariate-gaussian-hmm.html#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 1.39862795 0.143048208</span></span>
<span id="cb94-20"><a href="multivariate-gaussian-hmm.html#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 1.32776440 0.138042910</span></span>
<span id="cb94-21"><a href="multivariate-gaussian-hmm.html#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 1.39862795 0.143048208</span></span>
<span id="cb94-22"><a href="multivariate-gaussian-hmm.html#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 1.98516354 0.167983567</span></span>
<span id="cb94-23"><a href="multivariate-gaussian-hmm.html#cb94-23" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 1.43015056 0.145538312</span></span>
<span id="cb94-24"><a href="multivariate-gaussian-hmm.html#cb94-24" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 1.32776440 0.138042910</span></span>
<span id="cb94-25"><a href="multivariate-gaussian-hmm.html#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 1.43015056 0.145538312</span></span>
<span id="cb94-26"><a href="multivariate-gaussian-hmm.html#cb94-26" aria-hidden="true" tabindex="-1"></a><span class="do">## sigma 1.92236070 0.161913458</span></span>
<span id="cb94-27"><a href="multivariate-gaussian-hmm.html#cb94-27" aria-hidden="true" tabindex="-1"></a><span class="do">## gamma 0.94337605 0.008707558</span></span>
<span id="cb94-28"><a href="multivariate-gaussian-hmm.html#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="do">## gamma 0.13555932 0.019818312</span></span>
<span id="cb94-29"><a href="multivariate-gaussian-hmm.html#cb94-29" aria-hidden="true" tabindex="-1"></a><span class="do">## gamma 0.05662395 0.008707558</span></span>
<span id="cb94-30"><a href="multivariate-gaussian-hmm.html#cb94-30" aria-hidden="true" tabindex="-1"></a><span class="do">## gamma 0.86444068 0.019818312</span></span>
<span id="cb94-31"><a href="multivariate-gaussian-hmm.html#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="do">## delta 0.70536482 0.043981080</span></span>
<span id="cb94-32"><a href="multivariate-gaussian-hmm.html#cb94-32" aria-hidden="true" tabindex="-1"></a><span class="do">## delta 0.29463518 0.043981080</span></span>
<span id="cb94-33"><a href="multivariate-gaussian-hmm.html#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="co"># More readable estimates</span></span>
<span id="cb94-34"><a href="multivariate-gaussian-hmm.html#cb94-34" aria-hidden="true" tabindex="-1"></a>report <span class="ot">&lt;-</span> obj_tmb<span class="sc">$</span><span class="fu">report</span>()</span>
<span id="cb94-35"><a href="multivariate-gaussian-hmm.html#cb94-35" aria-hidden="true" tabindex="-1"></a>report</span>
<span id="cb94-36"><a href="multivariate-gaussian-hmm.html#cb94-36" aria-hidden="true" tabindex="-1"></a><span class="do">## $mu</span></span>
<span id="cb94-37"><a href="multivariate-gaussian-hmm.html#cb94-37" aria-hidden="true" tabindex="-1"></a><span class="do">##          [,1]     [,2]</span></span>
<span id="cb94-38"><a href="multivariate-gaussian-hmm.html#cb94-38" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] 5.979332 1.105792</span></span>
<span id="cb94-39"><a href="multivariate-gaussian-hmm.html#cb94-39" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] 7.974663 2.016963</span></span>
<span id="cb94-40"><a href="multivariate-gaussian-hmm.html#cb94-40" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] 9.034963 3.069443</span></span>
<span id="cb94-41"><a href="multivariate-gaussian-hmm.html#cb94-41" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb94-42"><a href="multivariate-gaussian-hmm.html#cb94-42" aria-hidden="true" tabindex="-1"></a><span class="do">## $sigma</span></span>
<span id="cb94-43"><a href="multivariate-gaussian-hmm.html#cb94-43" aria-hidden="true" tabindex="-1"></a><span class="do">## , , 1</span></span>
<span id="cb94-44"><a href="multivariate-gaussian-hmm.html#cb94-44" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb94-45"><a href="multivariate-gaussian-hmm.html#cb94-45" aria-hidden="true" tabindex="-1"></a><span class="do">##           [,1]      [,2]      [,3]</span></span>
<span id="cb94-46"><a href="multivariate-gaussian-hmm.html#cb94-46" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] 0.9894994 0.4675514 0.4527541</span></span>
<span id="cb94-47"><a href="multivariate-gaussian-hmm.html#cb94-47" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] 0.4675514 0.9452644 0.4794808</span></span>
<span id="cb94-48"><a href="multivariate-gaussian-hmm.html#cb94-48" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] 0.4527541 0.4794808 0.9498403</span></span>
<span id="cb94-49"><a href="multivariate-gaussian-hmm.html#cb94-49" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb94-50"><a href="multivariate-gaussian-hmm.html#cb94-50" aria-hidden="true" tabindex="-1"></a><span class="do">## , , 2</span></span>
<span id="cb94-51"><a href="multivariate-gaussian-hmm.html#cb94-51" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb94-52"><a href="multivariate-gaussian-hmm.html#cb94-52" aria-hidden="true" tabindex="-1"></a><span class="do">##          [,1]     [,2]     [,3]</span></span>
<span id="cb94-53"><a href="multivariate-gaussian-hmm.html#cb94-53" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] 1.846100 1.398628 1.327764</span></span>
<span id="cb94-54"><a href="multivariate-gaussian-hmm.html#cb94-54" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] 1.398628 1.985164 1.430151</span></span>
<span id="cb94-55"><a href="multivariate-gaussian-hmm.html#cb94-55" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] 1.327764 1.430151 1.922361</span></span>
<span id="cb94-56"><a href="multivariate-gaussian-hmm.html#cb94-56" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb94-57"><a href="multivariate-gaussian-hmm.html#cb94-57" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb94-58"><a href="multivariate-gaussian-hmm.html#cb94-58" aria-hidden="true" tabindex="-1"></a><span class="do">## $delta</span></span>
<span id="cb94-59"><a href="multivariate-gaussian-hmm.html#cb94-59" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.7055608 0.2944392</span></span>
<span id="cb94-60"><a href="multivariate-gaussian-hmm.html#cb94-60" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb94-61"><a href="multivariate-gaussian-hmm.html#cb94-61" aria-hidden="true" tabindex="-1"></a><span class="do">## $n</span></span>
<span id="cb94-62"><a href="multivariate-gaussian-hmm.html#cb94-62" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1000</span></span>
<span id="cb94-63"><a href="multivariate-gaussian-hmm.html#cb94-63" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb94-64"><a href="multivariate-gaussian-hmm.html#cb94-64" aria-hidden="true" tabindex="-1"></a><span class="do">## $gamma</span></span>
<span id="cb94-65"><a href="multivariate-gaussian-hmm.html#cb94-65" aria-hidden="true" tabindex="-1"></a><span class="do">##           [,1]       [,2]</span></span>
<span id="cb94-66"><a href="multivariate-gaussian-hmm.html#cb94-66" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] 0.9434294 0.05657056</span></span>
<span id="cb94-67"><a href="multivariate-gaussian-hmm.html#cb94-67" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] 0.1355593 0.86444068</span></span>
<span id="cb94-68"><a href="multivariate-gaussian-hmm.html#cb94-68" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb94-69"><a href="multivariate-gaussian-hmm.html#cb94-69" aria-hidden="true" tabindex="-1"></a><span class="do">## $mllk</span></span>
<span id="cb94-70"><a href="multivariate-gaussian-hmm.html#cb94-70" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4295.975</span></span></code></pre></div>
</div>
<div id="bias" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Bias</h2>
<p>Since the data was simulated, the true parameters are known and the validity of the estimates cam be checked.
To do this, we look at the maximum absolute percentage difference between estimates and true values.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="multivariate-gaussian-hmm.html#cb95-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">t</span>(report<span class="sc">$</span>mu) <span class="sc">-</span> mu) <span class="sc">/</span> mu</span>
<span id="cb95-2"><a href="multivariate-gaussian-hmm.html#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="do">##              [,1]         [,2]        [,3]</span></span>
<span id="cb95-3"><a href="multivariate-gaussian-hmm.html#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] -0.003444686 -0.003167169 0.003884787</span></span>
<span id="cb95-4"><a href="multivariate-gaussian-hmm.html#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,]  0.105791929  0.008481643 0.023147521</span></span>
<span id="cb95-5"><a href="multivariate-gaussian-hmm.html#cb95-5" aria-hidden="true" tabindex="-1"></a>(report<span class="sc">$</span>sigma <span class="sc">-</span> sigma) <span class="sc">/</span> sigma</span>
<span id="cb95-6"><a href="multivariate-gaussian-hmm.html#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="do">## , , 1</span></span>
<span id="cb95-7"><a href="multivariate-gaussian-hmm.html#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb95-8"><a href="multivariate-gaussian-hmm.html#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="do">##             [,1]        [,2]        [,3]</span></span>
<span id="cb95-9"><a href="multivariate-gaussian-hmm.html#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] -0.01050063 -0.06489716 -0.09449190</span></span>
<span id="cb95-10"><a href="multivariate-gaussian-hmm.html#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] -0.06489716 -0.05473563 -0.04103843</span></span>
<span id="cb95-11"><a href="multivariate-gaussian-hmm.html#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] -0.09449190 -0.04103843 -0.05015973</span></span>
<span id="cb95-12"><a href="multivariate-gaussian-hmm.html#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb95-13"><a href="multivariate-gaussian-hmm.html#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="do">## , , 2</span></span>
<span id="cb95-14"><a href="multivariate-gaussian-hmm.html#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb95-15"><a href="multivariate-gaussian-hmm.html#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="do">##             [,1]         [,2]        [,3]</span></span>
<span id="cb95-16"><a href="multivariate-gaussian-hmm.html#cb95-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] -0.07695023 -0.067581365 -0.11482373</span></span>
<span id="cb95-17"><a href="multivariate-gaussian-hmm.html#cb95-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] -0.06758137 -0.007418231 -0.04656629</span></span>
<span id="cb95-18"><a href="multivariate-gaussian-hmm.html#cb95-18" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] -0.11482373 -0.046566292 -0.03881965</span></span>
<span id="cb95-19"><a href="multivariate-gaussian-hmm.html#cb95-19" aria-hidden="true" tabindex="-1"></a>(report<span class="sc">$</span>gamma <span class="sc">-</span> gamma) <span class="sc">/</span> gamma</span>
<span id="cb95-20"><a href="multivariate-gaussian-hmm.html#cb95-20" aria-hidden="true" tabindex="-1"></a><span class="do">##              [,1]       [,2]</span></span>
<span id="cb95-21"><a href="multivariate-gaussian-hmm.html#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] -0.006916378 0.13141118</span></span>
<span id="cb95-22"><a href="multivariate-gaussian-hmm.html#cb95-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] -0.096271185 0.01698903</span></span></code></pre></div>
<p>Differences are at most in the order of 10% for values near 0. Parameter estimation was successful.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-R-mvtnorm" class="csl-entry">
Genz, A., Bretz, F., Miwa, T., Mi, X., &amp; Hothorn, T. (2021). <em>Mvtnorm: Multivariate normal and t distributions</em>. Retrieved from <a href="http://mvtnorm.R-forge.R-project.org">http://mvtnorm.R-forge.R-project.org</a>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gaussian-hmm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="github.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
