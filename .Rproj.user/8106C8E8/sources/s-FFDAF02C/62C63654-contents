# Application to different data sets

## TYT dataset

```{r}
set.seed(123)
library(TMB)
TMB::compile("code/poi_hmm.cpp")
dyn.load(dynlib("code/poi_hmm"))
source("functions/utils.R")
m <- 2
load("data/tinnitus.RData")
# Parameters and covariates
if (m == 1) {
  gamma <- matrix(1)
} else {
  gamma <- matrix(0.2 / (m - 1), nrow = m, ncol = m)
  diag(gamma) <- 0.8
}
lambda <- seq(quantile(tinn_data, 0.1), quantile(tinn_data, 0.9), length.out = m)
delta <- stat.dist(gamma)

# Parameters & covariates for TMB
working_params <- pois.HMM.pn2pw(m, lambda, gamma)
TMB_data <- list(x = tinn_data, m = m)
obj <- MakeADFun(TMB_data, working_params, DLL = "poi_hmm", silent = TRUE)

# Estimation via a wrapper for nlminb
tmb_gh <- TMB.estimate(TMB_data = TMB_data,
                       parameters = working_params,
                       MakeADFun_obj = obj,
                       gradient = TRUE,
                       hessian = TRUE)
```

