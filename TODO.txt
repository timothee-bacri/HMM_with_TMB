# SHOW THAT LM GIVES THE SAME RESULTS in linreg -done

MOVE THIS LINE -done
-> stupid example external code

ADD TEXT ABOUT DELTAMETHOD IN ADREPORT : -done
create pn, then pn2pw, then feed pw in TMB,
then TMB does pw2pn and gives it through ADREPORT
-> I added it in section 2 because it's better on the simple example I think

EQUATION FOR LINREG NEGATIVE LIKELIHOOD -done

Estimation HMM -> formula then code, formula then code -done, i think ?

reduce spacing between lines knitr - I think it's done by their documentclass

# MORE DESCRIPTION -done

# SPLIT R CODE WITH TEXT BETWEEN -done

MOTIVATION NESTED MODELS : flexibility -done

TABLES BEFORE AFTER FIXING LOW PARAMETERS TO 0, USE GREEK LEETERS -done

STD ERROR * normal 1.96 -done

PARAGRAPH ON HOW TO MAKE CI FOR TMB STD ERROR -done, check with geir, not citation yet
--> "NEED CITATION"

see p36

REMOVE GAMMA FROM M=1 -done
FIX GAMMA TO 1 FOR PROFILE -can't
-> I can't because it works by fixing some working parameters to NA,
but for 1 state gamma doesn't even have a working parameter
In addition, Gamma is defined to be 1 inside C++

Manually, the intervals I get include the estimate

1-2-3 STATES FOR SIMULATION -done
1-2 STATES FOR REAL DATASET -done

DO UNTIL PART 5

remove "This method doesn�t always work" ?? -done, made one or 2 lines explaining
In nested models, update the max value to (1-the others) ? -done, distribute remainder on all

PUT COMPLETE CODE IN APPENDIX
make special case for likelihood at m=1 ? -no ?
MORE DETAILS ON STUPID EXAMPLE IN LINREG -done

LOOK LINE 581: nlminb and opm give values for delta that are different (one ==1, the other not exactly ==1)
I think it comes from R and C++ approximations
Even when I add what's missing and distribute it (per row) to each cell, it fails ==1
-noted, i'm done with this

Keep "The reason is likely that it tries to optimize the likelihood despite the lack of parameters to change, and therefore fails." ?
 -keep for now


Take label switching into account for bootstrap -done
use ORDER -no, use standard approach and estimate lambda_i - lambda_i-1 instead of lambda_i, with lambda_0=0
-> no, use ORDER -done
Ask Geir: generate data with pois.HMM.generate_sample ? -done, yes
finish working example bootstrap -done

bootstrap -> WARN BIG VALUES, TO BE AWARE OF IT AND MAYBE DO SOMETHING -done

Do the state inference formulas, refer to equations in forward and backward -done

ASK JAN/GEIR: should i copy zucchini and put dpois or get.emission.probs ? -done, get.emission.probs

Application to hospital data, keep it simple -done

Only mention profile error, don't showcase it -done

Appendix -done, maybe smaller ?
Table for the different mllks, not a bar plot -done
Fix citation style -done
facet grid for multiple m in one graph -done, ask Geir and Jan about it

Interpret the states, day/night ? weekday/weekend ? season ? look at year, month, day, hour, small paragraph
Missing data, small paragraph -done

Replaced opm by nlminb where I could.

Find citation for Wald confidence intervals
Website for hospital data
Logarithm graphs when too big
Interpret the states, day/night ? weekday/weekend ? season ? look at year, month, day, hour, small paragraph

Test which m is best for hospital data
Should I time creating the likelihood function (MakeADFun) ? no
	llk		AIC		BIC		time makeadfun	time nlminb gr	time opm gr	time nlminb	time opm
m=1, 324 288		648 578		647 587.4	0.14		0.36		0.41
m=2, 259 295.2	20%-	518 598.4	518 636		0.44		2.87		2.6
m=3, 247 402.9	4.6%-	494 823.7	494 908.2	0.75		19.94		12.3
m=4, 242 586.8	1.9%-	485 205.5	485 355.6	1.11		52.32		22.72		68.86		33.36
^ 
| with system.time, on hospital data
opm (method nlminb) is twice as fast, but doesn't converge as well without exact gradient and hessian

switch to nlminb, except for other methods
look at trace of nlm, nlminb, opm, marqLevAlg for m=2
if opm gives special controls to nlminb, i can do it myself ?

iter.max = NULL default 150
maxit = NULL
abs.tol = 0 default 0
eval.max = comtrol$maxfeval = 10 000 default 200

start = spar = par/pscale = par/control$parscale = par/(1,1,1,1)
slower = lower/pscale = lower/(1,1,1,1)
supper = idem
gr = "grfwd" = Forward difference numerical gradient approximation OR normal fed gradient

nlminb time to create hessian ? Maybe why it's so slow
What does iter.max=NULL do ?
Create table summary, and show number of iterations, and likelihood to check results
Make paragraph in paper

Explanation ? Creating the hessian via nlminb in C/Fortran and estimating it is a lot faster than calling the R defined hessian function

nlminb doesn't even converge for m = 2 on lamb dataset

Redo optimizer differences subsection -done, deleted

Fix TPM == fix what moves in the working TPM tgamma ? -done, do Poisson means only
stop using opm ? Find out what gives the best acceleration and see if the delay from using opm is the same for all methods -done, stopped

intro:
3.6.1 2016 Zucchini
google: uncertainty evaluation

data supplements -> turn R into rnw or tex
nested model, no need to rerun a 2 state model, don't make it in terms of m -done
"For example, in R a small number is not 0" -> make that part smaller -done, check
i can convert code easily to other distributions -done, check
"Summary: 1 cpp file, 1 R file," -> complete -done
sec:hmm_likelihood -> put cpp code in appendix, and turn list into paragraphs -done
Using TMB : put Optimization 1st, likelihood function 2nd, computing stationary distribution 3rd, and add more transition sentences -done
update rnw code with changes to pois.HMM.pn2pw -done

rework linreg.cpp a little -done
use one convention for function names: start with capital letter or small letter


Ask Geir: delete subsection stationary distribution ? he will see with Jan

rewrite in appendix file structure before code, where should this code be put ? -done
part about NaN, put in Appendix above code, not in cpp file or in paragraph in rnw -done

make it into a story: hourly boxplots part etc, more transitions

mention leap days, and daylight savings time ?